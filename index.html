<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Arsip Bengkel SMK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .modal { backdrop-filter: blur(4px); }
        .image-preview { max-width: 100px; max-height: 100px; object-fit: cover; }
        .login-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 login-bg flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="bg-blue-600 p-4 rounded-full w-20 h-20 mx-auto mb-4">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Sistem Arsip Bengkel SMK</h2>
                <p class="text-gray-600 mt-2">Silakan login untuk melanjutkan</p>
            </div>
            
            <form id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                        <select id="userRole" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Role</option>
                            <option value="admin">Admin</option>
                            <option value="kekom">Kepala Kompetensi Keahlian</option>
                            <option value="kabeng">Kepala Bengkel</option>
                            <option value="waka_sarpras">Wakil Kepala Sarpras</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg mt-6 transition-colors">
                    Login
                </button>
            </form>
            
            
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b-4 border-blue-600">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="bg-blue-600 p-3 rounded-lg">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Sistem Arsip Bengkel SMK NEGERI 1 KEFAMENANU</h1>
                            <p class="text-xs text-gray-600 leading-tight">
                                <strong>Berlandaskan:</strong><br>
                                ‚Ä¢ Permendiknas No. 24 Tahun 2007 (Pasal 1‚Äì2) ‚Üí mengatur kewajiban penyediaan sarana-prasarana termasuk bengkel.<br>
                                ‚Ä¢ Permendikbud No. 34 Tahun 2018 (Pasal 2 ayat 1 & Lampiran VI) ‚Üí mengatur kewajiban pengelolaan sarana prasarana, termasuk dokumentasi dan pemeliharaan peralatan praktik.
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-500">SMK Negeri 1 Kefamenanu</p>
                            <p class="text-xs text-gray-400" id="currentDate"></p>
                            <p class="text-xs text-blue-600 font-medium" id="currentUser"></p>
                        </div>
                        <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8" id="navigationTabs">
                    <!-- Navigation will be populated based on user role -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 mb-8" id="dashboardCards">
                    <!-- Dashboard cards will be populated based on user role -->
                </div>

                <!-- Recent Activities -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Aktivitas Terbaru</h3>
                    <div class="space-y-4" id="recentActivities">
                        <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                            <div class="bg-blue-100 p-2 rounded-full">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">Sistem siap digunakan</p>
                                <p class="text-xs text-gray-500">Baru saja</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventaris Tab -->
            <div id="inventaris" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <!-- Filter for Waka role -->
                    <div id="wakaFilter" class="mb-6 bg-gray-50 p-4 rounded-lg hidden">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Filter Jurusan:</label>
                            <select id="majorFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="">Semua Jurusan</option>
                            </select>
                            <button onclick="filterInventarisByMajor()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                                üîç Tampilkan Hasil Filter
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Daftar Inventaris Peralatan</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('inventaris')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importInventaris" accept=".xlsx,.xls" class="hidden" onchange="importExcel('inventaris')">
                            <button onclick="document.getElementById('importInventaris').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('inventaris')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('inventaris')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddEquipmentModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Peralatan
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Peralatan</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Spesifikasi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jurusan</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kondisi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sumber Dana</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tahun</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="equipmentTable" class="bg-white divide-y divide-gray-200">
                                <!-- Equipment data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Jadwal Tab -->
            <div id="jadwal" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <!-- Filter for Waka role -->
                    <div id="wakaFilterJadwal" class="mb-6 bg-gray-50 p-4 rounded-lg hidden">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Filter Jurusan:</label>
                            <select id="majorFilterJadwal" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="">Semua Jurusan</option>
                            </select>
                            <button onclick="filterInventarisByMajor()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                                üîç Tampilkan Hasil Filter
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Jadwal Penggunaan Peralatan</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('jadwal')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importJadwal" accept=".xlsx,.xls" class="hidden" onchange="importExcel('jadwal')">
                            <button onclick="document.getElementById('importJadwal').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('jadwal')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('jadwal')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddScheduleModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Jadwal
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Peralatan</th>

                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleTable" class="bg-white divide-y divide-gray-200">
                                <!-- Schedule data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Praktik Tab -->
            <div id="praktik" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Laporan Praktik Penggunaan Alat & Bahan</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('praktik')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importPraktik" accept=".xlsx,.xls" class="hidden" onchange="importExcel('praktik')">
                            <button onclick="document.getElementById('importPraktik').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('praktik')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('praktik')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddReportModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Laporan Praktik
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter and Search -->
                    <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filter Kelas</label>
                                <select id="filterClass" onchange="filterPracticeReports()" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">Semua Kelas</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filter Status</label>
                                <select id="filterStatus" onchange="filterPracticeReports()" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">Semua Status</option>
                                    <option value="Selesai">Selesai</option>
                                    <option value="Dalam Proses">Dalam Proses</option>
                                    <option value="Belum Mulai">Belum Mulai</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filter Mata Pelajaran</label>
                                <select id="filterSubject" onchange="filterPracticeReports()" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">Semua Mata Pelajaran</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cari Siswa</label>
                                <input type="text" id="searchStudent" onkeyup="filterPracticeReports()" placeholder="Nama siswa..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6" id="practiceReports">
                        <!-- Practice reports will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Pemeliharaan Tab -->
            <div id="pemeliharaan" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <!-- Filter for Waka role -->
                    <div id="wakaFilterPemeliharaan" class="mb-6 bg-gray-50 p-4 rounded-lg hidden">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Filter Jurusan:</label>
                            <select id="majorFilterPemeliharaan" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="">Semua Jurusan</option>
                            </select>
                            <button onclick="filterInventarisByMajor()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                                üîç Tampilkan Hasil Filter
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Laporan Pemeliharaan Peralatan</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('pemeliharaan')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importPemeliharaan" accept=".xlsx,.xls" class="hidden" onchange="importExcel('pemeliharaan')">
                            <button onclick="document.getElementById('importPemeliharaan').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('pemeliharaan')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('pemeliharaan')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddMaintenanceModal()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Pemeliharaan
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4" id="maintenanceList">
                        <!-- Maintenance records will be populated here -->
                    </div>
                </div>
            </div>

            <!-- UKK & Kompetensi Tab -->
            <div id="ukk" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Dokumen UKK & Kompetensi Siswa</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('ukk')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importUkk" accept=".xlsx,.xls" class="hidden" onchange="importExcel('ukk')">
                            <button onclick="document.getElementById('importUkk').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('ukk')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('ukk')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddCompetencyModal()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Dokumen
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="competencyDocuments">
                        <!-- Competency documents will be populated here -->
                    </div>
                </div>
            </div>



            <!-- Sarana Prasarana Umum Tab (Waka Only) -->
            <div id="sarpras" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Sarana Prasarana Umum Sekolah</h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadTemplate('sarpras')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Template
                            </button>
                            <input type="file" id="importSarpras" accept=".xlsx,.xls" class="hidden" onchange="importExcel('sarpras')">
                            <button onclick="document.getElementById('importSarpras').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì• Import Excel
                            </button>
                            <button onclick="exportExcel('sarpras')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üì§ Export Excel
                            </button>
                            <button onclick="exportPDF('sarpras')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                üìÑ Export PDF
                            </button>
                            <button onclick="showAddSarprasModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah Sarana Prasarana
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Sarana/Prasarana</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kondisi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sumber Dana</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="sarprasTable" class="bg-white divide-y divide-gray-200">
                                <!-- Sarpras data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Kelola Master Tab (Admin Only) -->
            <div id="master" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Kategori Peralatan -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Kategori Peralatan</h3>
                            <button onclick="showAddCategoryModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah
                            </button>
                        </div>
                        <div class="space-y-2" id="categoryList">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>

                    <!-- Jurusan -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Jurusan</h3>
                            <button onclick="showAddMajorModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah
                            </button>
                        </div>
                        <div class="space-y-2" id="majorList">
                            <!-- Majors will be populated here -->
                        </div>
                    </div>

                    <!-- Mata Pelajaran -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Mata Pelajaran</h3>
                            <button onclick="showAddSubjectModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah
                            </button>
                        </div>
                        <div class="space-y-2" id="subjectList">
                            <!-- Subjects will be populated here -->
                        </div>
                    </div>

                    <!-- Kelas -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Kelas</h3>
                            <button onclick="showAddClassModal()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                + Tambah
                            </button>
                        </div>
                        <div class="space-y-2" id="classList">
                            <!-- Classes will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Equipment Modal -->
    <div id="addEquipmentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Peralatan Baru</h3>
            <form id="equipmentForm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kode Peralatan</label>
                        <input type="text" id="equipmentCode" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Peralatan</label>
                        <input type="text" id="equipmentName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                        <select id="equipmentCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Kategori</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Spesifikasi</label>
                        <input type="text" id="equipmentSpecification" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Contoh: 220V, 50Hz, 1000W">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jurusan</label>
                        <select id="equipmentMajor" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Jurusan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi</label>
                        <select id="equipmentCondition" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Kondisi</option>
                            <option value="Baik">Baik</option>
                            <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                            <option value="Rusak">Rusak</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sumber Dana</label>
                        <select id="equipmentFundingSource" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Sumber Dana</option>
                            <option value="APBN">APBN</option>
                            <option value="APBD">APBD</option>
                            <option value="BOS">BOS (Bantuan Operasional Sekolah)</option>
                            <option value="DAK">DAK (Dana Alokasi Khusus)</option>
                            <option value="Hibah">Hibah</option>
                            <option value="Swadaya">Swadaya Sekolah</option>
                            <option value="CSR">CSR (Corporate Social Responsibility)</option>
                            <option value="Donasi">Donasi</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tahun Pengadaan</label>
                        <select id="equipmentYear" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Tahun</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Foto Peralatan</label>
                        <input type="file" id="equipmentPhoto" accept="image/*" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div id="photoPreview" class="mt-2"></div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                        <textarea id="equipmentDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddEquipmentModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Tambah Kategori Baru</h3>
            <form id="categoryForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Kategori</label>
                        <input type="text" id="categoryName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddCategoryModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Major Modal -->
    <div id="addMajorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Tambah Jurusan Baru</h3>
            <form id="majorForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kode Jurusan</label>
                        <input type="text" id="majorCode" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Jurusan</label>
                        <input type="text" id="majorName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddMajorModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div id="addSubjectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Tambah Mata Pelajaran Baru</h3>
            <form id="subjectForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Mata Pelajaran</label>
                        <input type="text" id="subjectName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddSubjectModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="addClassModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Tambah Kelas Baru</h3>
            <form id="classForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Kelas</label>
                        <input type="text" id="className" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddClassModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div id="addScheduleModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Jadwal Penggunaan</h3>
            <form id="scheduleForm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Peralatan</label>
                        <select id="scheduleEquipment" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Peralatan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kelas</label>
                        <select id="scheduleClass" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Kelas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mata Pelajaran</label>
                        <select id="scheduleSubject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Mata Pelajaran</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Guru</label>
                        <input type="text" id="scheduleTeacher" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                        <input type="date" id="scheduleDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Waktu</label>
                        <input type="time" id="scheduleTime" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddScheduleModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Report Modal -->
    <div id="addReportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Laporan Praktik Penggunaan Alat & Bahan</h3>
            <form id="reportForm">
                <!-- Basic Information -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-900 mb-3">Informasi Dasar</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siswa</label>
                            <input type="text" id="reportStudent" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Kelas</label>
                            <select id="reportClass" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">Pilih Kelas</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">NIS</label>
                            <input type="text" id="reportNIS" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Judul Praktik</label>
                            <input type="text" id="reportTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mata Pelajaran</label>
                            <select id="reportSubject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">Pilih Mata Pelajaran</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Guru Pembimbing</label>
                            <input type="text" id="reportTeacher" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Praktik</label>
                            <input type="date" id="reportDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Waktu Mulai</label>
                            <input type="time" id="reportStartTime" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Waktu Selesai</label>
                            <input type="time" id="reportEndTime" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Equipment Used -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-900 mb-3">Alat yang Digunakan</h4>
                    <div id="equipmentUsedContainer">
                        <div class="equipment-item grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nama Alat</label>
                                <select class="equipment-select w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">Pilih Alat</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi Awal</label>
                                <select class="condition-before w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="Baik">Baik</option>
                                    <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                                    <option value="Rusak">Rusak</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi Akhir</label>
                                <select class="condition-after w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="Baik">Baik</option>
                                    <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                                    <option value="Rusak">Rusak</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button type="button" onclick="removeEquipmentItem(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">Hapus</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" onclick="addEquipmentItem()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">+ Tambah Alat</button>
                </div>

                <!-- Materials Used -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-900 mb-3">Bahan yang Digunakan</h4>
                    <div id="materialsUsedContainer">
                        <div class="material-item grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nama Bahan</label>
                                <input type="text" class="material-name w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="Contoh: Kawat tembaga">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah</label>
                                <input type="number" class="material-quantity w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" min="0" step="0.1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Satuan</label>
                                <select class="material-unit w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="pcs">Pcs</option>
                                    <option value="meter">Meter</option>
                                    <option value="kg">Kg</option>
                                    <option value="liter">Liter</option>
                                    <option value="gram">Gram</option>
                                    <option value="cm">Cm</option>
                                    <option value="mm">Mm</option>
                                    <option value="set">Set</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button type="button" onclick="removeMaterialItem(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">Hapus</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" onclick="addMaterialItem()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">+ Tambah Bahan</button>
                </div>

                <!-- Practice Details -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-900 mb-3">Detail Praktik</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tujuan Praktik</label>
                            <textarea id="reportObjective" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Jelaskan tujuan dari praktik ini..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Langkah Kerja</label>
                            <textarea id="reportProcedure" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Jelaskan langkah-langkah kerja..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hasil Praktik</label>
                            <textarea id="reportResult" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Jelaskan hasil yang dicapai..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Kesimpulan</label>
                            <textarea id="reportConclusion" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Tuliskan kesimpulan dari praktik..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Assessment -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-900 mb-3">Penilaian</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="reportStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">Pilih Status</option>
                                <option value="Selesai">Selesai</option>
                                <option value="Dalam Proses">Dalam Proses</option>
                                <option value="Belum Mulai">Belum Mulai</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nilai Praktik</label>
                            <input type="number" id="reportScore" min="0" max="100" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Grade</label>
                            <select id="reportGrade" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Pilih Grade</option>
                                <option value="A">A (Sangat Baik)</option>
                                <option value="B">B (Baik)</option>
                                <option value="C">C (Cukup)</option>
                                <option value="D">D (Kurang)</option>
                            </select>
                        </div>
                        <div class="md:col-span-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Catatan Guru</label>
                            <textarea id="reportNotes" rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Catatan atau saran dari guru pembimbing..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddReportModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan Laporan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Maintenance Modal -->
    <div id="addMaintenanceModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Pemeliharaan</h3>
            <form id="maintenanceForm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Peralatan</label>
                        <select id="maintenanceEquipment" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Peralatan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Pemeliharaan</label>
                        <select id="maintenanceType" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Perawatan Rutin">Perawatan Rutin</option>
                            <option value="Perbaikan">Perbaikan</option>
                            <option value="Kalibrasi">Kalibrasi</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="maintenanceStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Status</option>
                            <option value="Selesai">Selesai</option>
                            <option value="Dalam Proses">Dalam Proses</option>
                            <option value="Dijadwalkan">Dijadwalkan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Teknisi</label>
                        <input type="text" id="maintenanceTechnician" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                        <input type="date" id="maintenanceDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Biaya</label>
                        <input type="number" id="maintenanceCost" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tahun Pemeliharaan</label>
                        <select id="maintenanceYear" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Tahun</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sumber Dana</label>
                        <select id="maintenanceFundingSource" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Sumber Dana</option>
                            <option value="APBN">APBN</option>
                            <option value="APBD">APBD</option>
                            <option value="BOS">BOS (Bantuan Operasional Sekolah)</option>
                            <option value="DAK">DAK (Dana Alokasi Khusus)</option>
                            <option value="Hibah">Hibah</option>
                            <option value="Swadaya">Swadaya Sekolah</option>
                            <option value="CSR">CSR (Corporate Social Responsibility)</option>
                            <option value="Donasi">Donasi</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Foto Pemeliharaan</label>
                        <input type="file" id="maintenancePhoto" accept="image/*" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div id="maintenancePhotoPreview" class="mt-2"></div>
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                        <textarea id="maintenanceDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddMaintenanceModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Sarpras Modal -->
    <div id="addSarprasModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Sarana Prasarana Umum</h3>
            <form id="sarprasForm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kode Sarana/Prasarana</label>
                        <input type="text" id="sarprasCode" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Sarana/Prasarana</label>
                        <input type="text" id="sarprasName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                        <select id="sarprasCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Kategori</option>
                            <option value="Ruang Kelas">Ruang Kelas</option>
                            <option value="Laboratorium">Laboratorium</option>
                            <option value="Bengkel">Bengkel</option>
                            <option value="Perpustakaan">Perpustakaan</option>
                            <option value="Ruang Guru">Ruang Guru</option>
                            <option value="Ruang Kepala Sekolah">Ruang Kepala Sekolah</option>
                            <option value="Ruang TU">Ruang TU</option>
                            <option value="Aula">Aula</option>
                            <option value="Mushola">Mushola</option>
                            <option value="Kantin">Kantin</option>
                            <option value="Toilet">Toilet</option>
                            <option value="Lapangan">Lapangan</option>
                            <option value="Parkir">Parkir</option>
                            <option value="Gudang">Gudang</option>
                            <option value="Infrastruktur">Infrastruktur</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Lokasi</label>
                        <input type="text" id="sarprasLocation" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi</label>
                        <select id="sarprasCondition" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Kondisi</option>
                            <option value="Baik">Baik</option>
                            <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                            <option value="Rusak">Rusak</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Luas (m¬≤)</label>
                        <input type="number" id="sarprasArea" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sumber Dana</label>
                        <select id="sarprasFundingSource" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Sumber Dana</option>
                            <option value="APBN">APBN</option>
                            <option value="APBD">APBD</option>
                            <option value="BOS">BOS (Bantuan Operasional Sekolah)</option>
                            <option value="DAK">DAK (Dana Alokasi Khusus)</option>
                            <option value="Hibah">Hibah</option>
                            <option value="Swadaya">Swadaya Sekolah</option>
                            <option value="CSR">CSR (Corporate Social Responsibility)</option>
                            <option value="Donasi">Donasi</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Foto Sarana/Prasarana</label>
                        <input type="file" id="sarprasPhoto" accept="image/*" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div id="sarprasPhotoPreview" class="mt-2"></div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                        <textarea id="sarprasDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddSarprasModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Competency Modal -->
    <div id="addCompetencyModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">Tambah Dokumen UKK & Kompetensi</h3>
            <form id="competencyForm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siswa</label>
                        <input type="text" id="competencyStudent" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jurusan</label>
                        <select id="competencyMajor" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Jurusan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kompetensi</label>
                        <input type="text" id="competencySkill" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="competencyStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Pilih Status</option>
                            <option value="Lulus">Lulus</option>
                            <option value="Tidak Lulus">Tidak Lulus</option>
                            <option value="Mengulang">Mengulang</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal UKK</label>
                        <input type="date" id="competencyDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nilai</label>
                        <input type="number" id="competencyScore" min="0" max="100" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Catatan</label>
                        <textarea id="competencyNotes" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideAddCompetencyModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                    <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Detail Data</h3>
                <button onclick="hideDetailModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="detailContent">
                <!-- Detail content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let equipment = [];
        let schedules = [];
        let practiceReports = [];
        let maintenanceRecords = [];
        let competencyDocuments = [];
        let sarprasData = [];
        let categories = [
            // TKP - Teknik Konstruksi dan Perumahan
            'Alat Ukur Konstruksi', 'Alat Bangunan', 'Peralatan Beton', 'Alat Survei',
            // DPIB - Desain Pemodelan dan Informasi Bangunan
            'Software CAD', 'Komputer Desain', 'Printer Plotter', 'Scanner 3D',
            // TKR - Teknik Kendaraan Ringan
            'Alat Diagnosa Otomotif', 'Peralatan Engine', 'Alat Transmisi', 'Peralatan Chasis',
            // TSM - Teknik Sepeda Motor
            'Alat Servis Motor', 'Peralatan Mesin Motor', 'Alat Diagnosa Motor', 'Peralatan Kelistrikan Motor',
            // TAV - Teknik Audio Video
            'Peralatan Audio', 'Peralatan Video', 'Alat Ukur Elektronik', 'Komponen Elektronik',
            // TITL - Teknik Instalasi Tenaga Listrik
            'Alat Ukur Listrik', 'Peralatan Instalasi', 'Alat Keselamatan Listrik', 'Komponen Listrik',
            // TKJ - Teknik Komputer dan Jaringan
            'Komputer & Laptop', 'Peralatan Jaringan', 'Server & Storage', 'Alat Crimping',
            // DPB - Desain dan Produksi Busana
            'Mesin Jahit', 'Alat Potong Kain', 'Peralatan Desain', 'Alat Ukur Busana',
            // Umum
            'Peralatan Umum', 'Alat Keselamatan Kerja'
        ];
        let majors = [
            { code: 'TKP', name: 'Teknik Konstruksi dan Perumahan' },
            { code: 'DPIB', name: 'Desain Pemodelan dan Informasi Bangunan' },
            { code: 'TKR', name: 'Teknik Kendaraan Ringan' },
            { code: 'TSM', name: 'Teknik Sepeda Motor' },
            { code: 'TAV', name: 'Teknik Audio Video' },
            { code: 'TITL', name: 'Teknik Instalasi Tenaga Listrik' },
            { code: 'TKJ', name: 'Teknik Komputer dan Jaringan' },
            { code: 'DPB', name: 'Desain dan Produksi Busana' }
        ];
        let subjects = ['Konstruksi Bangunan', 'Desain Bangunan', 'Sistem Kelistrikan Otomotif', 'Perawatan Mesin Sepeda Motor', 'Sistem Audio Video', 'Instalasi Listrik', 'Jaringan Komputer', 'Desain Busana', 'Produksi Busana'];
        let classes = [
            'X TKP 1', 'XI TKP 1', 'XII TKP 1', 'X TKP 2', 'XI TKP 2', 'XII TKP 2',
            'X DPIB 1', 'XI DPIB 1', 'XII DPIB 1', 'X DPIB 2', 'XI DPIB 2', 'XII DPIB 2',
            'X TKR 1', 'XI TKR 1', 'XII TKR 1', 'X TKR 2', 'XI TKR 2', 'XII TKR 2',
            'X TSM 1', 'XI TSM 1', 'XII TSM 1', 'X TSM 2', 'XI TSM 2', 'XII TSM 2',
            'X TAV', 'XI TAV', 'XII TAV',
            'X TITL 1', 'XI TITL 1', 'XII TITL 1', 'X TITL 2', 'XI TITL 2', 'XII TITL 2',
            'X TKJ', 'XI TKJ', 'XII TKJ',
            'X DPB', 'XI DPB', 'XII DPB'
        ];

        // User credentials
        const users = {
            'admin': { password: 'admin123', role: 'admin', name: 'Administrator' },
            // Kekom untuk setiap jurusan
            'kekom_tkp': { password: 'kekom123', role: 'kekom', name: 'Kekom TKP', major: 'TKP' },
            'kekom_dpib': { password: 'kekom123', role: 'kekom', name: 'Kekom DPIB', major: 'DPIB' },
            'kekom_tkr': { password: 'kekom123', role: 'kekom', name: 'Kekom TKR', major: 'TKR' },
            'kekom_tsm': { password: 'kekom123', role: 'kekom', name: 'Kekom TSM', major: 'TSM' },
            'kekom_tav': { password: 'kekom123', role: 'kekom', name: 'Kekom TAV', major: 'TAV' },
            'kekom_titl': { password: 'kekom123', role: 'kekom', name: 'Kekom TITL', major: 'TITL' },
            'kekom_tkj': { password: 'kekom123', role: 'kekom', name: 'Kekom TKJ', major: 'TKJ' },
            'kekom_dpb': { password: 'kekom123', role: 'kekom', name: 'Kekom DPB', major: 'DPB' },
            // Kabeng untuk setiap jurusan
            'kabeng_tkp': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TKP', major: 'TKP' },
            'kabeng_dpib': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng DPIB', major: 'DPIB' },
            'kabeng_tkr': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TKR', major: 'TKR' },
            'kabeng_tsm': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TSM', major: 'TSM' },
            'kabeng_tav': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TAV', major: 'TAV' },
            'kabeng_titl': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TITL', major: 'TITL' },
            'kabeng_tkj': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng TKJ', major: 'TKJ' },
            'kabeng_dpb': { password: 'kabeng123', role: 'kabeng', name: 'Kabeng DPB', major: 'DPB' },
            'waka': { password: 'waka123', role: 'waka_sarpras', name: 'Wakil Kepala Sarpras' }
        };

        // Role permissions
        const rolePermissions = {
            admin: ['dashboard', 'inventaris', 'jadwal', 'praktik', 'pemeliharaan', 'ukk', 'master'],
            kekom: ['dashboard', 'praktik', 'ukk'],
            kabeng: ['dashboard', 'inventaris', 'jadwal', 'pemeliharaan'],
            waka_sarpras: ['dashboard', 'inventaris', 'pemeliharaan', 'sarpras']
        };

        // Modal functions
        function showAddEquipmentModal() {
            document.getElementById('addEquipmentModal').classList.remove('hidden');
            document.getElementById('addEquipmentModal').classList.add('flex');
        }

        function hideAddEquipmentModal() {
            document.getElementById('addEquipmentModal').classList.add('hidden');
            document.getElementById('addEquipmentModal').classList.remove('flex');
            document.getElementById('equipmentForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
        }

        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('hidden');
            document.getElementById('addCategoryModal').classList.add('flex');
        }

        function hideAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('hidden');
            document.getElementById('addCategoryModal').classList.remove('flex');
            document.getElementById('categoryForm').reset();
        }

        function showAddMajorModal() {
            document.getElementById('addMajorModal').classList.remove('hidden');
            document.getElementById('addMajorModal').classList.add('flex');
        }

        function hideAddMajorModal() {
            document.getElementById('addMajorModal').classList.add('hidden');
            document.getElementById('addMajorModal').classList.remove('flex');
            document.getElementById('majorForm').reset();
        }

        function showAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.remove('hidden');
            document.getElementById('addSubjectModal').classList.add('flex');
        }

        function hideAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.add('hidden');
            document.getElementById('addSubjectModal').classList.remove('flex');
            document.getElementById('subjectForm').reset();
        }

        function showAddClassModal() {
            document.getElementById('addClassModal').classList.remove('hidden');
            document.getElementById('addClassModal').classList.add('flex');
        }

        function hideAddClassModal() {
            document.getElementById('addClassModal').classList.add('hidden');
            document.getElementById('addClassModal').classList.remove('flex');
            document.getElementById('classForm').reset();
        }

        function showAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.remove('hidden');
            document.getElementById('addScheduleModal').classList.add('flex');
        }

        function hideAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.add('hidden');
            document.getElementById('addScheduleModal').classList.remove('flex');
            document.getElementById('scheduleForm').reset();
        }

        function showAddReportModal() {
            document.getElementById('addReportModal').classList.remove('hidden');
            document.getElementById('addReportModal').classList.add('flex');
            
            // Populate equipment selects in the form
            populateEquipmentSelects();
            
            // Populate initial equipment select
            const equipmentSelects = document.querySelectorAll('.equipment-select');
            equipmentSelects.forEach(select => {
                select.innerHTML = '<option value="">Pilih Alat</option>';
                equipment.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.code} - ${item.name}`;
                    select.appendChild(option);
                });
            });
        }

        function hideAddReportModal() {
            document.getElementById('addReportModal').classList.add('hidden');
            document.getElementById('addReportModal').classList.remove('flex');
            document.getElementById('reportForm').reset();
        }

        function showAddMaintenanceModal() {
            document.getElementById('addMaintenanceModal').classList.remove('hidden');
            document.getElementById('addMaintenanceModal').classList.add('flex');
        }

        function hideAddMaintenanceModal() {
            document.getElementById('addMaintenanceModal').classList.add('hidden');
            document.getElementById('addMaintenanceModal').classList.remove('flex');
            document.getElementById('maintenanceForm').reset();
            document.getElementById('maintenancePhotoPreview').innerHTML = '';
        }

        function showAddSarprasModal() {
            document.getElementById('addSarprasModal').classList.remove('hidden');
            document.getElementById('addSarprasModal').classList.add('flex');
        }

        function hideAddSarprasModal() {
            document.getElementById('addSarprasModal').classList.add('hidden');
            document.getElementById('addSarprasModal').classList.remove('flex');
            document.getElementById('sarprasForm').reset();
            document.getElementById('sarprasPhotoPreview').innerHTML = '';
        }

        function showAddCompetencyModal() {
            document.getElementById('addCompetencyModal').classList.remove('hidden');
            document.getElementById('addCompetencyModal').classList.add('flex');
        }

        function hideAddCompetencyModal() {
            document.getElementById('addCompetencyModal').classList.add('hidden');
            document.getElementById('addCompetencyModal').classList.remove('flex');
            document.getElementById('competencyForm').reset();
        }

        function hideDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
            document.getElementById('detailModal').classList.remove('flex');
        }

        // Logout function
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                currentUser = null;
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Reset form
                document.getElementById('loginForm').reset();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupLoginForm();
            loadSampleData();
            
            // Equipment form
            document.getElementById('equipmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newEquipment = {
                    id: equipment.length + 1,
                    code: document.getElementById('equipmentCode').value,
                    name: document.getElementById('equipmentName').value,
                    category: document.getElementById('equipmentCategory').value,
                    specification: document.getElementById('equipmentSpecification').value,
                    major: document.getElementById('equipmentMajor').value,
                    condition: document.getElementById('equipmentCondition').value,
                    fundingSource: document.getElementById('equipmentFundingSource').value,
                    year: document.getElementById('equipmentYear').value,
                    dateAdded: new Date().toISOString().split('T')[0],
                    photo: '', // Handle photo upload if needed
                    description: document.getElementById('equipmentDescription').value
                };
                
                equipment.push(newEquipment);
                renderEquipmentTable();
                updateDashboard();
                populateEquipmentSelects();
                hideAddEquipmentModal();
                addRecentActivity('Peralatan baru ditambahkan');
            });

            // Category form
            document.getElementById('categoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const categoryName = document.getElementById('categoryName').value;
                if (!categories.includes(categoryName)) {
                    categories.push(categoryName);
                    renderMasterData();
                    populateCategories();
                    hideAddCategoryModal();
                    addRecentActivity('Kategori baru ditambahkan');
                } else {
                    alert('Kategori sudah ada!');
                }
            });

            // Major form
            document.getElementById('majorForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const majorCode = document.getElementById('majorCode').value;
                const majorName = document.getElementById('majorName').value;
                
                if (!majors.find(m => m.code === majorCode)) {
                    majors.push({ code: majorCode, name: majorName });
                    renderMasterData();
                    populateMajors();
                    hideAddMajorModal();
                    addRecentActivity('Jurusan baru ditambahkan');
                } else {
                    alert('Kode jurusan sudah ada!');
                }
            });

            // Subject form
            document.getElementById('subjectForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const subjectName = document.getElementById('subjectName').value;
                if (!subjects.includes(subjectName)) {
                    subjects.push(subjectName);
                    renderMasterData();
                    populateSubjects();
                    hideAddSubjectModal();
                    addRecentActivity('Mata pelajaran baru ditambahkan');
                } else {
                    alert('Mata pelajaran sudah ada!');
                }
            });

            // Class form
            document.getElementById('classForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const className = document.getElementById('className').value;
                if (!classes.includes(className)) {
                    classes.push(className);
                    renderMasterData();
                    populateClasses();
                    hideAddClassModal();
                    addRecentActivity('Kelas baru ditambahkan');
                } else {
                    alert('Kelas sudah ada!');
                }
            });

            // Schedule form
            document.getElementById('scheduleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newSchedule = {
                    id: schedules.length + 1,
                    equipmentId: parseInt(document.getElementById('scheduleEquipment').value),
                    class: document.getElementById('scheduleClass').value,
                    subject: document.getElementById('scheduleSubject').value,
                    teacher: document.getElementById('scheduleTeacher').value,
                    date: document.getElementById('scheduleDate').value,
                    time: document.getElementById('scheduleTime').value
                };
                
                schedules.push(newSchedule);
                renderScheduleTable();
                hideAddScheduleModal();
                addRecentActivity('Jadwal baru ditambahkan');
            });

            // Report form
            document.getElementById('reportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Collect equipment used data
                const equipmentUsed = [];
                document.querySelectorAll('.equipment-item').forEach(item => {
                    const equipmentSelect = item.querySelector('.equipment-select');
                    const conditionBefore = item.querySelector('.condition-before');
                    const conditionAfter = item.querySelector('.condition-after');
                    
                    if (equipmentSelect.value) {
                        equipmentUsed.push({
                            equipmentId: parseInt(equipmentSelect.value),
                            conditionBefore: conditionBefore.value,
                            conditionAfter: conditionAfter.value
                        });
                    }
                });
                
                // Collect materials used data
                const materialsUsed = [];
                document.querySelectorAll('.material-item').forEach(item => {
                    const name = item.querySelector('.material-name');
                    const quantity = item.querySelector('.material-quantity');
                    const unit = item.querySelector('.material-unit');
                    
                    if (name.value && quantity.value) {
                        materialsUsed.push({
                            name: name.value,
                            quantity: parseFloat(quantity.value),
                            unit: unit.value
                        });
                    }
                });
                
                const newReport = {
                    id: practiceReports.length + 1,
                    student: document.getElementById('reportStudent').value,
                    nis: document.getElementById('reportNIS').value,
                    class: document.getElementById('reportClass').value,
                    title: document.getElementById('reportTitle').value,
                    subject: document.getElementById('reportSubject').value,
                    teacher: document.getElementById('reportTeacher').value,
                    date: document.getElementById('reportDate').value,
                    startTime: document.getElementById('reportStartTime').value,
                    endTime: document.getElementById('reportEndTime').value,
                    equipmentUsed: equipmentUsed,
                    materialsUsed: materialsUsed,
                    objective: document.getElementById('reportObjective').value,
                    procedure: document.getElementById('reportProcedure').value,
                    result: document.getElementById('reportResult').value,
                    conclusion: document.getElementById('reportConclusion').value,
                    status: document.getElementById('reportStatus').value,
                    score: parseInt(document.getElementById('reportScore').value) || 0,
                    grade: document.getElementById('reportGrade').value,
                    notes: document.getElementById('reportNotes').value
                };
                
                practiceReports.push(newReport);
                renderPracticeReports();
                updateDashboard();
                hideAddReportModal();
                addRecentActivity('Laporan praktik baru ditambahkan');
            });

            // Maintenance form
            document.getElementById('maintenanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newMaintenance = {
                    id: maintenanceRecords.length + 1,
                    equipmentId: parseInt(document.getElementById('maintenanceEquipment').value),
                    type: document.getElementById('maintenanceType').value,
                    status: document.getElementById('maintenanceStatus').value,
                    technician: document.getElementById('maintenanceTechnician').value,
                    date: document.getElementById('maintenanceDate').value,
                    cost: parseInt(document.getElementById('maintenanceCost').value) || 0,
                    year: document.getElementById('maintenanceYear').value,
                    fundingSource: document.getElementById('maintenanceFundingSource').value,
                    photo: '', // Handle photo upload if needed
                    description: document.getElementById('maintenanceDescription').value
                };
                
                maintenanceRecords.push(newMaintenance);
                renderMaintenanceList();
                updateDashboard();
                hideAddMaintenanceModal();
                addRecentActivity('Data pemeliharaan baru ditambahkan');
            });

            // Sarpras form
            document.getElementById('sarprasForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newSarpras = {
                    id: sarprasData.length + 1,
                    code: document.getElementById('sarprasCode').value,
                    name: document.getElementById('sarprasName').value,
                    category: document.getElementById('sarprasCategory').value,
                    location: document.getElementById('sarprasLocation').value,
                    condition: document.getElementById('sarprasCondition').value,
                    area: parseInt(document.getElementById('sarprasArea').value) || 0,
                    fundingSource: document.getElementById('sarprasFundingSource').value,
                    dateAdded: new Date().toISOString().split('T')[0],
                    photo: '',
                    description: document.getElementById('sarprasDescription').value
                };
                
                sarprasData.push(newSarpras);
                renderSarprasTable();
                updateDashboard();
                hideAddSarprasModal();
                addRecentActivity('Sarana prasarana baru ditambahkan');
            });

            // Competency form
            document.getElementById('competencyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newCompetency = {
                    id: competencyDocuments.length + 1,
                    student: document.getElementById('competencyStudent').value,
                    major: document.getElementById('competencyMajor').value,
                    competency: document.getElementById('competencySkill').value,
                    status: document.getElementById('competencyStatus').value,
                    date: document.getElementById('competencyDate').value,
                    score: parseInt(document.getElementById('competencyScore').value),
                    notes: document.getElementById('competencyNotes').value
                };
                
                competencyDocuments.push(newCompetency);
                renderCompetencyDocuments();
                updateDashboard();
                hideAddCompetencyModal();
                addRecentActivity('Dokumen kompetensi baru ditambahkan');
            });

            // Photo preview
            document.getElementById('equipmentPhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('photoPreview');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" class="image-preview rounded-lg" alt="Preview">`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.innerHTML = '';
                }
            });

            // Sarpras photo preview
            document.getElementById('sarprasPhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('sarprasPhotoPreview');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" class="image-preview rounded-lg" alt="Preview">`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.innerHTML = '';
                }
            });

            // Maintenance photo preview
            document.getElementById('maintenancePhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('maintenancePhotoPreview');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" class="image-preview rounded-lg" alt="Preview">`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.innerHTML = '';
                }
            });
        });

        // Setup login form
        function setupLoginForm() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const role = document.getElementById('userRole').value;
                
                console.log('Login attempt:', { username, password, role }); // Debug log
                
                // Check if user exists and credentials match
                if (users[username] && users[username].password === password && users[username].role === role) {
                    currentUser = {
                        username: username,
                        role: role,
                        name: users[username].name
                    };
                    
                    console.log('Login successful:', currentUser); // Debug log
                    
                    // Hide login screen and show main app
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    // Initialize the application
                    initializeApp();
                } else {
                    console.log('Login failed - invalid credentials'); // Debug log
                    alert('Username, password, atau role tidak valid!\n\nGunakan kredensial demo yang tersedia di bawah form login.');
                }
            });
            
            // Add demo credential buttons for easy testing
            addDemoLoginButtons();
        }
        
        // Add demo login buttons for easy access
        function addDemoLoginButtons() {
            const loginForm = document.getElementById('loginForm');
            const demoSection = loginForm.parentElement.querySelector('.mt-6.p-4.bg-gray-50');
            
            if (demoSection) {
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'mt-3 space-y-2';
                buttonContainer.innerHTML = `
                    <p class="text-xs text-gray-600 font-medium">Quick Login:</p>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <button type="button" onclick="quickLogin('admin')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Admin</button>
                        <button type="button" onclick="quickLogin('waka')" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-xs">Waka Sarpras</button>
                    </div>
                    <p class="text-xs text-gray-600 font-medium mt-3">Kepala Kompetensi Keahlian:</p>
                    <div class="grid grid-cols-4 gap-1 mb-1">
                        <button type="button" onclick="quickLogin('kekom_tkp')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TKP</button>
                        <button type="button" onclick="quickLogin('kekom_dpib')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">DPIB</button>
                        <button type="button" onclick="quickLogin('kekom_tkr')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TKR</button>
                        <button type="button" onclick="quickLogin('kekom_tsm')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TSM</button>
                    </div>
                    <div class="grid grid-cols-4 gap-1 mb-2">
                        <button type="button" onclick="quickLogin('kekom_tav')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TAV</button>
                        <button type="button" onclick="quickLogin('kekom_titl')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TITL</button>
                        <button type="button" onclick="quickLogin('kekom_tkj')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">TKJ</button>
                        <button type="button" onclick="quickLogin('kekom_dpb')" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs">DPB</button>
                    </div>
                    <p class="text-xs text-gray-600 font-medium">Kepala Bengkel:</p>
                    <div class="grid grid-cols-4 gap-1 mb-1">
                        <button type="button" onclick="quickLogin('kabeng_tkp')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TKP</button>
                        <button type="button" onclick="quickLogin('kabeng_dpib')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">DPIB</button>
                        <button type="button" onclick="quickLogin('kabeng_tkr')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TKR</button>
                        <button type="button" onclick="quickLogin('kabeng_tsm')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TSM</button>
                    </div>
                    <div class="grid grid-cols-4 gap-1">
                        <button type="button" onclick="quickLogin('kabeng_tav')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TAV</button>
                        <button type="button" onclick="quickLogin('kabeng_titl')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TITL</button>
                        <button type="button" onclick="quickLogin('kabeng_tkj')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">TKJ</button>
                        <button type="button" onclick="quickLogin('kabeng_dpb')" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs">DPB</button>
                    </div>
                `;
                demoSection.appendChild(buttonContainer);
            }
        }
        
        // Quick login function for demo
        function quickLogin(userType) {
            const credentials = {
                admin: { username: 'admin', password: 'admin123', role: 'admin' },
                waka: { username: 'waka', password: 'waka123', role: 'waka_sarpras' },
                // Kekom untuk setiap jurusan
                kekom_tkp: { username: 'kekom_tkp', password: 'kekom123', role: 'kekom' },
                kekom_dpib: { username: 'kekom_dpib', password: 'kekom123', role: 'kekom' },
                kekom_tkr: { username: 'kekom_tkr', password: 'kekom123', role: 'kekom' },
                kekom_tsm: { username: 'kekom_tsm', password: 'kekom123', role: 'kekom' },
                kekom_tav: { username: 'kekom_tav', password: 'kekom123', role: 'kekom' },
                kekom_titl: { username: 'kekom_titl', password: 'kekom123', role: 'kekom' },
                kekom_tkj: { username: 'kekom_tkj', password: 'kekom123', role: 'kekom' },
                kekom_dpb: { username: 'kekom_dpb', password: 'kekom123', role: 'kekom' },
                // Kabeng untuk setiap jurusan
                kabeng_tkp: { username: 'kabeng_tkp', password: 'kabeng123', role: 'kabeng' },
                kabeng_dpib: { username: 'kabeng_dpib', password: 'kabeng123', role: 'kabeng' },
                kabeng_tkr: { username: 'kabeng_tkr', password: 'kabeng123', role: 'kabeng' },
                kabeng_tsm: { username: 'kabeng_tsm', password: 'kabeng123', role: 'kabeng' },
                kabeng_tav: { username: 'kabeng_tav', password: 'kabeng123', role: 'kabeng' },
                kabeng_titl: { username: 'kabeng_titl', password: 'kabeng123', role: 'kabeng' },
                kabeng_tkj: { username: 'kabeng_tkj', password: 'kabeng123', role: 'kabeng' },
                kabeng_dpb: { username: 'kabeng_dpb', password: 'kabeng123', role: 'kabeng' }
            };
            
            const cred = credentials[userType];
            if (cred) {
                document.getElementById('username').value = cred.username;
                document.getElementById('password').value = cred.password;
                document.getElementById('userRole').value = cred.role;
                
                // Trigger form submission
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
        }

        // Initialize app after login
        function initializeApp() {
            updateCurrentDate();
            updateCurrentUser();
            setupNavigation();
            setupDashboard();
            updateDashboard();
            renderAllData();
            populateSelects();
            setupWakaFilters();
            autoSelectMajorFilter(); // Auto-select filter for Waka role
            showTab('dashboard');
        }

        // Setup filters for Waka role
        function setupWakaFilters() {
            if (currentUser.role === 'waka_sarpras') {
                // Show filter sections
                document.getElementById('wakaFilter').classList.remove('hidden');
                document.getElementById('wakaFilterJadwal').classList.remove('hidden');
                document.getElementById('wakaFilterPemeliharaan').classList.remove('hidden');
                
                // Populate major filters
                const filterSelects = ['majorFilter', 'majorFilterJadwal', 'majorFilterPemeliharaan'];
                filterSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '<option value="">Semua Jurusan</option>';
                        majors.forEach(major => {
                            const option = document.createElement('option');
                            option.value = major.code;
                            option.textContent = `${major.code} - ${major.name}`;
                            select.appendChild(option);
                        });
                    }
                });
            }
        }

        // Global filter variable for Waka
        let currentMajorFilter = '';

        // Filter by major for Waka role
        function filterByMajor() {
            if (currentUser.role !== 'waka_sarpras') return;
            
            // Get filter value from any of the filter selects
            const filterValue = document.getElementById('majorFilter').value || 
                               document.getElementById('majorFilterJadwal').value || 
                               document.getElementById('majorFilterPemeliharaan').value;
            
            currentMajorFilter = filterValue;
            
            // Sync all filter selects
            document.getElementById('majorFilter').value = filterValue;
            document.getElementById('majorFilterJadwal').value = filterValue;
            document.getElementById('majorFilterPemeliharaan').value = filterValue;
            
            // Re-render all data with filter
            renderAllData();
            updateDashboard();
        }

        // Filter inventaris by major specifically
        function filterInventarisByMajor() {
            if (currentUser.role !== 'waka_sarpras') return;
            
            const filterValue = document.getElementById('majorFilter').value;
            currentMajorFilter = filterValue;
            
            // Re-render equipment table with filter
            renderEquipmentTable();
            updateDashboard();
            
            // Show feedback message
            const message = filterValue ? 
                `Filter diterapkan untuk jurusan: ${filterValue}` : 
                'Filter dihapus, menampilkan semua data';
            
            // Create temporary notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 fade-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Auto-select major filter for Waka role
        function autoSelectMajorFilter() {
            if (currentUser.role === 'waka_sarpras') {
                // Auto-select the first major for demonstration
                if (majors.length > 0) {
                    currentMajorFilter = majors[0].code;
                    
                    // Update all filter selects
                    const filterSelects = ['majorFilter', 'majorFilterJadwal', 'majorFilterPemeliharaan'];
                    filterSelects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            select.value = currentMajorFilter;
                        }
                    });
                    
                    // Re-render data with auto-selected filter
                    renderAllData();
                    updateDashboard();
                }
            }
        }

        // Get user's major if they have one
        function getUserMajor() {
            return currentUser && users[currentUser.username] ? users[currentUser.username].major : null;
        }

        // Filter data by user's major
        function filterDataByMajor(data, majorField = 'major') {
            const userMajor = getUserMajor();
            
            // Admin can see all data
            if (!userMajor || currentUser.role === 'admin') {
                return data;
            }
            
            // Waka can see all data, but can filter by major if selected
            if (currentUser.role === 'waka_sarpras') {
                if (currentMajorFilter) {
                    return data.filter(item => {
                        if (majorField === 'category') {
                            // For equipment, filter by category related to major
                            const majorCategories = getMajorCategories(currentMajorFilter);
                            return majorCategories.includes(item.category);
                        } else if (majorField === 'class') {
                            // For class-based data, filter by class that contains major code
                            return item.class && item.class.includes(currentMajorFilter);
                        } else if (majorField === 'equipmentCategory') {
                            // For maintenance records, filter by equipment's major
                            const equipmentItem = equipment.find(e => e.id === item.equipmentId);
                            if (equipmentItem) {
                                const majorCategories = getMajorCategories(currentMajorFilter);
                                return majorCategories.includes(equipmentItem.category);
                            }
                            return false;
                        } else {
                            // Direct major field comparison
                            return item[majorField] === currentMajorFilter;
                        }
                    });
                }
                return data; // Show all data if no filter selected
            }
            
            return data.filter(item => {
                if (majorField === 'category') {
                    // For equipment, filter by category related to major
                    const majorCategories = getMajorCategories(userMajor);
                    return majorCategories.includes(item.category);
                } else if (majorField === 'class') {
                    // For class-based data, filter by class that contains major code
                    return item.class && item.class.includes(userMajor);
                } else {
                    // Direct major field comparison (for UKK)
                    return item[majorField] === userMajor;
                }
            });
        }

        // Get categories for specific major
        function getMajorCategories(majorCode) {
            const majorCategoryMap = {
                'TKP': ['Alat Ukur Konstruksi', 'Alat Bangunan', 'Peralatan Beton', 'Alat Survei'],
                'DPIB': ['Software CAD', 'Komputer Desain', 'Printer Plotter', 'Scanner 3D'],
                'TKR': ['Alat Diagnosa Otomotif', 'Peralatan Engine', 'Alat Transmisi', 'Peralatan Chasis'],
                'TSM': ['Alat Servis Motor', 'Peralatan Mesin Motor', 'Alat Diagnosa Motor', 'Peralatan Kelistrikan Motor'],
                'TAV': ['Peralatan Audio', 'Peralatan Video', 'Alat Ukur Elektronik', 'Komponen Elektronik'],
                'TITL': ['Alat Ukur Listrik', 'Peralatan Instalasi', 'Alat Keselamatan Listrik', 'Komponen Listrik'],
                'TKJ': ['Komputer & Laptop', 'Peralatan Jaringan', 'Server & Storage', 'Alat Crimping'],
                'DPB': ['Mesin Jahit', 'Alat Potong Kain', 'Peralatan Desain', 'Alat Ukur Busana']
            };
            return majorCategoryMap[majorCode] || [];
        }

        // Get categories for Waka role (general infrastructure only)
        function getWakaCategories() {
            return [
                'Ruang Kelas', 'Laboratorium', 'Bengkel', 'Perpustakaan', 'Ruang Guru',
                'Ruang Kepala Sekolah', 'Ruang TU', 'Aula', 'Mushola', 'Kantin',
                'Toilet', 'Lapangan', 'Parkir', 'Gudang', 'Infrastruktur',
                'Peralatan Umum', 'Alat Keselamatan Kerja'
            ];
        }

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        }

        // Update current user display
        function updateCurrentUser() {
            document.getElementById('currentUser').textContent = `${currentUser.name} (${currentUser.role.toUpperCase()})`;
        }

        // Setup navigation based on role
        function setupNavigation() {
            const navTabs = document.getElementById('navigationTabs');
            navTabs.innerHTML = '';
            
            const allowedTabs = rolePermissions[currentUser.role];
            
            const tabConfig = {
                dashboard: { name: 'Dashboard', icon: 'üìä' },
                inventaris: { name: 'Inventaris Peralatan', icon: 'üì¶' },
                jadwal: { name: 'Jadwal Penggunaan', icon: 'üìÖ' },
                praktik: { name: 'Laporan Praktik', icon: 'üìù' },
                pemeliharaan: { name: 'Pemeliharaan', icon: 'üîß' },
                ukk: { name: 'UKK & Kompetensi', icon: 'üèÜ' },
                sarpras: { name: 'Sarana Prasarana Umum', icon: 'üè¢' },
                master: { name: 'Kelola Master', icon: '‚öôÔ∏è' }
            };
            
            allowedTabs.forEach((tabId, index) => {
                const config = tabConfig[tabId];
                const button = document.createElement('button');
                button.onclick = () => showTab(tabId);
                button.className = `tab-btn py-4 px-2 border-b-2 ${index === 0 ? 'border-blue-600 text-blue-600 active' : 'border-transparent text-gray-500 hover:text-gray-700'} font-medium text-sm`;
                button.innerHTML = `${config.icon} ${config.name}`;
                navTabs.appendChild(button);
            });
        }

        // Setup dashboard based on role
        function setupDashboard() {
            const dashboardCards = document.getElementById('dashboardCards');
            dashboardCards.innerHTML = '';
            
            const cardConfigs = {
                admin: [
                    { id: 'totalEquipment', title: 'Total Peralatan', icon: 'üì¶', color: 'blue', tab: 'inventaris' },
                    { id: 'goodCondition', title: 'Kondisi Baik', icon: '‚úÖ', color: 'green', tab: 'inventaris' },
                    { id: 'needRepair', title: 'Perlu Perbaikan', icon: '‚ö†Ô∏è', color: 'yellow', tab: 'pemeliharaan' },
                    { id: 'totalReports', title: 'Laporan Praktik', icon: 'üìù', color: 'purple', tab: 'praktik' },
                    { id: 'totalMaintenance', title: 'Pemeliharaan', icon: 'üîß', color: 'orange', tab: 'pemeliharaan' },
                    { id: 'totalUKK', title: 'Total UKK', icon: 'üèÜ', color: 'red', tab: 'ukk' }
                ],
                kekom: [
                    { id: 'totalReports', title: 'Laporan Praktik', icon: 'üìù', color: 'purple', tab: 'praktik' },
                    { id: 'totalUKK', title: 'UKK Lulus', icon: 'üèÜ', color: 'red', tab: 'ukk' },
                    { id: 'passedUKK', title: 'Siswa Lulus', icon: 'üéì', color: 'green', tab: 'ukk' }
                ],
                kabeng: [
                    { id: 'totalEquipment', title: 'Total Peralatan', icon: 'üì¶', color: 'blue', tab: 'inventaris' },
                    { id: 'goodCondition', title: 'Kondisi Baik', icon: '‚úÖ', color: 'green', tab: 'inventaris' },
                    { id: 'needRepair', title: 'Perlu Perbaikan', icon: '‚ö†Ô∏è', color: 'yellow', tab: 'pemeliharaan' },
                    { id: 'totalMaintenance', title: 'Pemeliharaan', icon: 'üîß', color: 'orange', tab: 'pemeliharaan' }
                ],
                waka_sarpras: [
                    { id: 'totalEquipment', title: 'Total Peralatan', icon: 'üì¶', color: 'blue', tab: 'inventaris' },
                    { id: 'goodCondition', title: 'Kondisi Baik', icon: '‚úÖ', color: 'green', tab: 'inventaris' },
                    { id: 'needRepair', title: 'Perlu Perbaikan', icon: '‚ö†Ô∏è', color: 'yellow', tab: 'pemeliharaan' },
                    { id: 'totalMaintenance', title: 'Pemeliharaan', icon: 'üîß', color: 'orange', tab: 'pemeliharaan' },
                    { id: 'totalSarpras', title: 'Sarana Prasarana', icon: 'üè¢', color: 'indigo', tab: 'sarpras' },
                    { id: 'totalArea', title: 'Total Luas Area', icon: 'üìê', color: 'teal', tab: 'sarpras' }
                ]
            };
            
            const cards = cardConfigs[currentUser.role] || cardConfigs.admin;
            
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = `bg-white rounded-xl shadow-md p-6 card-hover cursor-pointer`;
                cardElement.onclick = () => showTab(card.tab);
                cardElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="bg-${card.color}-100 p-3 rounded-lg">
                            <span class="text-2xl">${card.icon}</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">${card.title}</p>
                            <p class="text-2xl font-bold text-gray-900" id="${card.id}">0</p>
                        </div>
                    </div>
                `;
                dashboardCards.appendChild(cardElement);
            });
        }

        // Load sample data
        function loadSampleData() {
            equipment = [
                // TKP Equipment
                { 
                    id: 1, 
                    code: 'TKP001', 
                    name: 'Theodolite Digital', 
                    category: 'Alat Survei',
                    specification: 'Akurasi 2", Display LCD, Baterai Li-ion',
                    major: 'TKP',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-01-15',
                    photo: '',
                    description: 'Theodolite digital untuk praktik survei dan pemetaan'
                },
                { 
                    id: 2, 
                    code: 'TKP002', 
                    name: 'Waterpass Digital', 
                    category: 'Alat Ukur Konstruksi',
                    specification: 'Akurasi ¬±0.5mm/m, Range 100m, IP65',
                    major: 'TKP',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2023',
                    dateAdded: '2024-01-16',
                    photo: '',
                    description: 'Waterpass digital untuk pengukuran ketinggian'
                },
                { 
                    id: 3, 
                    code: 'TKP003', 
                    name: 'Concrete Mixer', 
                    category: 'Peralatan Beton',
                    specification: '220V, 1.5HP, Kapasitas 150L, Portable',
                    major: 'TKP',
                    condition: 'Baik',
                    fundingSource: 'APBD',
                    year: '2022',
                    dateAdded: '2024-01-17',
                    photo: '',
                    description: 'Mesin pengaduk beton untuk praktik konstruksi'
                },
                // TITL Equipment
                { 
                    id: 4, 
                    code: 'TITL001', 
                    name: 'Multimeter Digital Fluke', 
                    category: 'Alat Ukur Listrik',
                    specification: 'True RMS, 6000 Count, CAT III 1000V, Auto Range',
                    major: 'TITL',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-01-20',
                    photo: '',
                    description: 'Multimeter digital untuk pengukuran listrik dan elektronika'
                },
                { 
                    id: 5, 
                    code: 'TITL002', 
                    name: 'Tang Ampere', 
                    category: 'Alat Ukur Listrik',
                    specification: 'AC/DC 1000A, True RMS, CAT III 600V',
                    major: 'TITL',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2023',
                    dateAdded: '2024-01-21',
                    photo: '',
                    description: 'Tang ampere untuk pengukuran arus listrik'
                },
                { 
                    id: 6, 
                    code: 'TITL003', 
                    name: 'Safety Helmet', 
                    category: 'Alat Keselamatan Listrik',
                    specification: 'Class E, 20kV, ABS Material, Adjustable',
                    major: 'TITL',
                    condition: 'Baik',
                    fundingSource: 'Swadaya',
                    year: '2022',
                    dateAdded: '2024-01-22',
                    photo: '',
                    description: 'Helm keselamatan untuk praktik instalasi listrik'
                },
                // TKJ Equipment
                { 
                    id: 7, 
                    code: 'TKJ001', 
                    name: 'Laptop Asus ROG', 
                    category: 'Komputer & Laptop',
                    specification: 'Intel i7, 16GB RAM, 512GB SSD, GTX 1650',
                    major: 'TKJ',
                    condition: 'Perlu Perbaikan',
                    fundingSource: 'DAK',
                    year: '2022',
                    dateAdded: '2024-02-01',
                    photo: '',
                    description: 'Laptop untuk praktik programming dan jaringan'
                },
                { 
                    id: 8, 
                    code: 'TKJ002', 
                    name: 'Switch 24 Port', 
                    category: 'Peralatan Jaringan',
                    specification: 'Gigabit Ethernet, Managed, VLAN Support',
                    major: 'TKJ',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2023',
                    dateAdded: '2024-02-02',
                    photo: '',
                    description: 'Switch 24 port untuk praktik jaringan'
                },
                { 
                    id: 9, 
                    code: 'TKJ003', 
                    name: 'Crimping Tool RJ45', 
                    category: 'Alat Crimping',
                    specification: 'RJ45/RJ11, Cable Tester, Wire Stripper',
                    major: 'TKJ',
                    condition: 'Baik',
                    fundingSource: 'Swadaya',
                    year: '2023',
                    dateAdded: '2024-02-03',
                    photo: '',
                    description: 'Alat crimping untuk kabel jaringan'
                },
                // TKR Equipment
                { 
                    id: 10, 
                    code: 'TKR001', 
                    name: 'Scanner OBD2', 
                    category: 'Alat Diagnosa Otomotif',
                    specification: 'OBD2/EOBD, Multi-brand, Live Data, DTC',
                    major: 'TKR',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-02-05',
                    photo: '',
                    description: 'Scanner OBD2 untuk diagnosa sistem elektronik kendaraan'
                },
                { 
                    id: 11, 
                    code: 'TKR002', 
                    name: 'Engine Stand', 
                    category: 'Peralatan Engine',
                    specification: 'Kapasitas 500kg, Adjustable Height, Steel Frame',
                    major: 'TKR',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2022',
                    dateAdded: '2024-02-06',
                    photo: '',
                    description: 'Stand mesin untuk praktik overhaul engine'
                },
                { 
                    id: 12, 
                    code: 'TKR003', 
                    name: 'Transmission Jack', 
                    category: 'Alat Transmisi',
                    specification: 'Kapasitas 1 Ton, Hydraulic, Adjustable',
                    major: 'TKR',
                    condition: 'Baik',
                    fundingSource: 'APBD',
                    year: '2023',
                    dateAdded: '2024-02-07',
                    photo: '',
                    description: 'Jack transmisi untuk praktik sistem transmisi'
                },
                // DPB Equipment
                { 
                    id: 13, 
                    code: 'DPB001', 
                    name: 'Mesin Jahit Industrial', 
                    category: 'Mesin Jahit',
                    specification: '220V, 550W, 5000 SPM, Automatic Thread Cut',
                    major: 'DPB',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-02-10',
                    photo: '',
                    description: 'Mesin jahit industrial untuk produksi busana'
                },
                { 
                    id: 14, 
                    code: 'DPB002', 
                    name: 'Gunting Kain Elektrik', 
                    category: 'Alat Potong Kain',
                    specification: '220V, 100W, Blade 4 inch, Cordless',
                    major: 'DPB',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2023',
                    dateAdded: '2024-02-11',
                    photo: '',
                    description: 'Gunting elektrik untuk memotong kain'
                },
                { 
                    id: 15, 
                    code: 'DPB003', 
                    name: 'Pita Ukur Jahit', 
                    category: 'Alat Ukur Busana',
                    specification: '150cm, Fiberglass, Flexible, Metric/Inch',
                    major: 'DPB',
                    condition: 'Baik',
                    fundingSource: 'Swadaya',
                    year: '2022',
                    dateAdded: '2024-02-12',
                    photo: '',
                    description: 'Pita ukur khusus untuk mengukur tubuh'
                },
                // TAV Equipment
                { 
                    id: 16, 
                    code: 'TAV001', 
                    name: 'Oscilloscope Digital', 
                    category: 'Alat Ukur Elektronik',
                    specification: '100MHz, 4 Channel, 1GSa/s, 7 inch Display',
                    major: 'TAV',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-02-15',
                    photo: '',
                    description: 'Oscilloscope digital untuk analisis sinyal audio video'
                },
                { 
                    id: 17, 
                    code: 'TAV002', 
                    name: 'Mixer Audio 16 Channel', 
                    category: 'Peralatan Audio',
                    specification: '16 Input, 4 Bus, EQ 3-Band, USB Interface',
                    major: 'TAV',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2022',
                    dateAdded: '2024-02-16',
                    photo: '',
                    description: 'Mixer audio 16 channel untuk praktik sound system'
                },
                { 
                    id: 18, 
                    code: 'TAV003', 
                    name: 'Kamera Video 4K', 
                    category: 'Peralatan Video',
                    specification: '4K 60fps, 3-Axis Gimbal, 128GB Storage',
                    major: 'TAV',
                    condition: 'Baik',
                    fundingSource: 'Hibah',
                    year: '2023',
                    dateAdded: '2024-02-17',
                    photo: '',
                    description: 'Kamera video 4K untuk praktik produksi video'
                },
                // TSM Equipment
                { 
                    id: 19, 
                    code: 'TSM001', 
                    name: 'Compression Tester', 
                    category: 'Alat Diagnosa Motor',
                    specification: '0-300 PSI, Quick Connect, Analog Gauge',
                    major: 'TSM',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-02-20',
                    photo: '',
                    description: 'Alat uji kompresi mesin sepeda motor'
                },
                { 
                    id: 20, 
                    code: 'TSM002', 
                    name: 'Engine Analyzer Motor', 
                    category: 'Peralatan Mesin Motor',
                    specification: 'RPM, Timing, Dwell, Voltage, Multi-brand',
                    major: 'TSM',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2022',
                    dateAdded: '2024-02-21',
                    photo: '',
                    description: 'Analyzer untuk diagnosa mesin sepeda motor'
                },
                { 
                    id: 21, 
                    code: 'TSM003', 
                    name: 'Multitester Motor', 
                    category: 'Peralatan Kelistrikan Motor',
                    specification: 'AC/DC Voltage, Current, Resistance, Diode Test',
                    major: 'TSM',
                    condition: 'Baik',
                    fundingSource: 'Swadaya',
                    year: '2023',
                    dateAdded: '2024-02-22',
                    photo: '',
                    description: 'Multitester khusus untuk kelistrikan sepeda motor'
                },
                // DPIB Equipment
                { 
                    id: 22, 
                    code: 'DPIB001', 
                    name: 'Workstation CAD', 
                    category: 'Komputer Desain',
                    specification: 'Intel Xeon, 32GB RAM, Quadro RTX, 1TB SSD',
                    major: 'DPIB',
                    condition: 'Baik',
                    fundingSource: 'DAK',
                    year: '2023',
                    dateAdded: '2024-02-25',
                    photo: '',
                    description: 'Workstation khusus untuk desain CAD dan BIM'
                },
                { 
                    id: 23, 
                    code: 'DPIB002', 
                    name: 'Plotter A0', 
                    category: 'Printer Plotter',
                    specification: 'A0 Size, 1200dpi, Inkjet, Network Ready',
                    major: 'DPIB',
                    condition: 'Baik',
                    fundingSource: 'BOS',
                    year: '2022',
                    dateAdded: '2024-02-26',
                    photo: '',
                    description: 'Plotter A0 untuk mencetak gambar teknik'
                },
                { 
                    id: 24, 
                    code: 'DPIB003', 
                    name: '3D Scanner Portable', 
                    category: 'Scanner 3D',
                    specification: 'Accuracy 0.1mm, Range 0.3-4m, USB 3.0',
                    major: 'DPIB',
                    condition: 'Baik',
                    fundingSource: 'Hibah',
                    year: '2023',
                    dateAdded: '2024-02-27',
                    photo: '',
                    description: 'Scanner 3D portable untuk scanning objek'
                }
            ];

            schedules = [
                {
                    id: 1,
                    equipmentId: 1,
                    class: 'XII TKP 1',
                    subject: 'Konstruksi Bangunan',
                    teacher: 'Pak Budi',
                    date: '2024-03-15',
                    time: '08:00'
                },
                {
                    id: 2,
                    equipmentId: 2,
                    class: 'XI TKJ',
                    subject: 'Jaringan Komputer',
                    teacher: 'Bu Sari',
                    date: '2024-03-16',
                    time: '10:00'
                }
            ];

            practiceReports = [
                // TKJ Reports
                { 
                    id: 1, 
                    student: 'Ahmad Rizki',
                    nis: '2021001',
                    class: 'XII TKJ', 
                    title: 'Instalasi Jaringan LAN',
                    subject: 'Jaringan Komputer',
                    teacher: 'Bu Sari Dewi',
                    date: '2024-03-01',
                    startTime: '08:00',
                    endTime: '11:00',
                    equipmentUsed: [
                        { equipmentId: 7, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 8, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 9, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'Kabel UTP Cat 6', quantity: 50, unit: 'meter' },
                        { name: 'Connector RJ45', quantity: 20, unit: 'pcs' },
                        { name: 'Patch Panel', quantity: 1, unit: 'set' }
                    ],
                    objective: 'Memahami dan mempraktikkan instalasi jaringan LAN menggunakan kabel UTP dan switch',
                    procedure: '1. Persiapan alat dan bahan\n2. Crimping kabel UTP\n3. Testing kabel\n4. Konfigurasi switch\n5. Testing konektivitas',
                    result: 'Berhasil membuat jaringan LAN dengan 10 komputer yang terhubung dengan baik',
                    conclusion: 'Instalasi jaringan LAN berhasil dilakukan dengan baik, semua komputer dapat berkomunikasi',
                    status: 'Selesai',
                    score: 85,
                    grade: 'A',
                    notes: 'Sangat baik dalam praktik, pemahaman konsep jaringan sangat bagus'
                },
                // DPB Reports
                { 
                    id: 2, 
                    student: 'Siti Nurhaliza',
                    nis: '2021002',
                    class: 'XII DPB', 
                    title: 'Pembuatan Pola Dasar Busana Wanita',
                    subject: 'Desain Busana',
                    teacher: 'Bu Maria Fatima',
                    date: '2024-03-05',
                    startTime: '13:00',
                    endTime: '16:00',
                    equipmentUsed: [
                        { equipmentId: 13, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 15, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'Kertas Pola', quantity: 2, unit: 'meter' },
                        { name: 'Pensil 2B', quantity: 1, unit: 'pcs' },
                        { name: 'Penggaris Pola', quantity: 1, unit: 'set' }
                    ],
                    objective: 'Membuat pola dasar busana wanita sesuai dengan ukuran standar',
                    procedure: '1. Mengambil ukuran\n2. Menggambar pola dasar\n3. Memberi tanda pola\n4. Memotong pola\n5. Finishing pola',
                    result: 'Berhasil membuat pola dasar busana wanita dengan proporsi yang tepat',
                    conclusion: 'Pola dasar berhasil dibuat dengan baik dan siap untuk digunakan',
                    status: 'Selesai',
                    score: 88,
                    grade: 'A',
                    notes: 'Sangat teliti dalam pembuatan pola, hasil sangat rapi'
                },
                // TKR Reports
                { 
                    id: 3, 
                    student: 'Budi Santoso',
                    nis: '2021003',
                    class: 'XII TKR 1', 
                    title: 'Diagnosa Sistem Engine',
                    subject: 'Sistem Kelistrikan Otomotif',
                    teacher: 'Pak Agus Wijaya',
                    date: '2024-03-08',
                    startTime: '08:00',
                    endTime: '12:00',
                    equipmentUsed: [
                        { equipmentId: 10, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 11, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'Oli Mesin', quantity: 1, unit: 'liter' },
                        { name: 'Filter Oli', quantity: 1, unit: 'pcs' },
                        { name: 'Busi', quantity: 1, unit: 'pcs' }
                    ],
                    objective: 'Melakukan diagnosa dan perawatan sistem engine kendaraan',
                    procedure: '1. Pemeriksaan visual\n2. Scanning dengan OBD2\n3. Analisis data\n4. Perbaikan yang diperlukan\n5. Testing sistem',
                    result: 'Berhasil mendiagnosa masalah engine dan melakukan perbaikan',
                    conclusion: 'Diagnosa yang tepat sangat penting untuk perawatan kendaraan',
                    status: 'Selesai',
                    score: 82,
                    grade: 'B',
                    notes: 'Baik dalam praktik, perlu lebih teliti dalam analisis data'
                },
                // TITL Reports
                { 
                    id: 4, 
                    student: 'Andi Wijaya',
                    nis: '2021004',
                    class: 'XII TITL 1', 
                    title: 'Instalasi Panel Listrik',
                    subject: 'Instalasi Listrik',
                    teacher: 'Pak Bambang Sutrisno',
                    date: '2024-03-10',
                    startTime: '08:00',
                    endTime: '12:00',
                    equipmentUsed: [
                        { equipmentId: 4, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 5, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 6, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'Kabel NYA 2.5mm', quantity: 20, unit: 'meter' },
                        { name: 'MCB 10A', quantity: 3, unit: 'pcs' },
                        { name: 'Panel Box', quantity: 1, unit: 'set' }
                    ],
                    objective: 'Memasang instalasi panel listrik sesuai standar keselamatan',
                    procedure: '1. Persiapan alat dan bahan\n2. Pemasangan panel box\n3. Instalasi MCB\n4. Pemasangan kabel\n5. Testing instalasi',
                    result: 'Panel listrik terpasang dengan baik dan aman',
                    conclusion: 'Instalasi listrik harus mengikuti standar keselamatan yang ketat',
                    status: 'Selesai',
                    score: 90,
                    grade: 'A',
                    notes: 'Sangat baik dalam mengikuti prosedur keselamatan'
                },
                // TKP Reports
                { 
                    id: 5, 
                    student: 'Dedi Kurniawan',
                    nis: '2021005',
                    class: 'XII TKP 1', 
                    title: 'Pengukuran Topografi',
                    subject: 'Konstruksi Bangunan',
                    teacher: 'Pak Hendra Saputra',
                    date: '2024-03-12',
                    startTime: '07:00',
                    endTime: '11:00',
                    equipmentUsed: [
                        { equipmentId: 1, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 2, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'Patok Ukur', quantity: 10, unit: 'pcs' },
                        { name: 'Rambu Ukur', quantity: 2, unit: 'pcs' },
                        { name: 'Meteran 50m', quantity: 1, unit: 'pcs' }
                    ],
                    objective: 'Melakukan pengukuran topografi untuk perencanaan konstruksi',
                    procedure: '1. Setup theodolite\n2. Kalibrasi alat\n3. Pengukuran sudut dan jarak\n4. Pencatatan data\n5. Perhitungan koordinat',
                    result: 'Data topografi berhasil dikumpulkan dengan akurat',
                    conclusion: 'Pengukuran yang akurat adalah dasar dari konstruksi yang baik',
                    status: 'Selesai',
                    score: 87,
                    grade: 'A',
                    notes: 'Teliti dalam pengukuran dan pencatatan data'
                },
                // TAV Reports
                { 
                    id: 6, 
                    student: 'Rina Sari',
                    nis: '2021006',
                    class: 'XII TAV', 
                    title: 'Produksi Video Dokumenter',
                    subject: 'Sistem Audio Video',
                    teacher: 'Bu Indira Sari',
                    date: '2024-03-15',
                    startTime: '13:00',
                    endTime: '17:00',
                    equipmentUsed: [
                        { equipmentId: 16, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 17, conditionBefore: 'Baik', conditionAfter: 'Baik' },
                        { equipmentId: 18, conditionBefore: 'Baik', conditionAfter: 'Baik' }
                    ],
                    materialsUsed: [
                        { name: 'SD Card 64GB', quantity: 2, unit: 'pcs' },
                        { name: 'Baterai Kamera', quantity: 3, unit: 'pcs' },
                        { name: 'Tripod', quantity: 1, unit: 'set' }
                    ],
                    objective: 'Membuat video dokumenter dengan kualitas broadcast',
                    procedure: '1. Pre-production planning\n2. Setup peralatan\n3. Recording video\n4. Audio mixing\n5. Post-production editing',
                    result: 'Video dokumenter 10 menit dengan kualitas HD berhasil diproduksi',
                    conclusion: 'Produksi video memerlukan perencanaan yang matang dan teknik yang baik',
                    status: 'Selesai',
                    score: 92,
                    grade: 'A',
                    notes: 'Sangat kreatif dan teknis yang baik dalam produksi video'
                }
            ];

            maintenanceRecords = [
                { 
                    id: 1, 
                    equipmentId: 1, 
                    type: 'Perawatan Rutin', 
                    status: 'Selesai',
                    description: 'Pembersihan dan pelumasan theodolite digital', 
                    date: '2024-03-01', 
                    technician: 'Pak Budi Santoso',
                    cost: 150000,
                    year: '2024',
                    fundingSource: 'BOS',
                    photo: ''
                },
                { 
                    id: 2, 
                    equipmentId: 7, 
                    type: 'Perbaikan', 
                    status: 'Dalam Proses',
                    description: 'Perbaikan keyboard dan layar laptop', 
                    date: '2024-03-10', 
                    technician: 'Pak Andi Wijaya',
                    cost: 500000,
                    year: '2024',
                    fundingSource: 'Swadaya',
                    photo: ''
                },
                { 
                    id: 3, 
                    equipmentId: 4, 
                    type: 'Kalibrasi', 
                    status: 'Selesai',
                    description: 'Kalibrasi multimeter digital sesuai standar', 
                    date: '2024-02-15', 
                    technician: 'Pak Slamet Riyadi',
                    cost: 200000,
                    year: '2024',
                    fundingSource: 'DAK',
                    photo: ''
                },
                { 
                    id: 4, 
                    equipmentId: 13, 
                    type: 'Perawatan Rutin', 
                    status: 'Selesai',
                    description: 'Service rutin mesin jahit industrial', 
                    date: '2024-02-20', 
                    technician: 'Bu Sari Dewi',
                    cost: 300000,
                    year: '2024',
                    fundingSource: 'BOS',
                    photo: ''
                }
            ];

            competencyDocuments = [
                { 
                    id: 1, 
                    student: 'Ahmad Rizki', 
                    major: 'TKJ',
                    competency: 'Administrasi Jaringan', 
                    status: 'Lulus', 
                    date: '2024-03-10', 
                    score: 85,
                    notes: 'Sangat baik dalam praktik jaringan'
                },
                { 
                    id: 2, 
                    student: 'Budi Santoso', 
                    major: 'TKR',
                    competency: 'Sistem Kelistrikan Otomotif', 
                    status: 'Lulus', 
                    date: '2024-03-12', 
                    score: 78,
                    notes: 'Baik dalam praktik kelistrikan'
                },
                { 
                    id: 3, 
                    student: 'Maria Fatima', 
                    major: 'DPB',
                    competency: 'Produksi Busana', 
                    status: 'Lulus', 
                    date: '2024-03-14', 
                    score: 88,
                    notes: 'Sangat kreatif dalam desain busana'
                },
                { 
                    id: 4, 
                    student: 'Andi Wijaya', 
                    major: 'TITL',
                    competency: 'Instalasi Listrik Bangunan', 
                    status: 'Lulus', 
                    date: '2024-03-16', 
                    score: 90,
                    notes: 'Sangat teliti dalam instalasi listrik'
                },
                { 
                    id: 5, 
                    student: 'Dedi Kurniawan', 
                    major: 'TKP',
                    competency: 'Konstruksi Bangunan Gedung', 
                    status: 'Lulus', 
                    date: '2024-03-18', 
                    score: 82,
                    notes: 'Baik dalam praktik konstruksi'
                },
                { 
                    id: 6, 
                    student: 'Rina Sari', 
                    major: 'TAV',
                    competency: 'Produksi Audio Video', 
                    status: 'Lulus', 
                    date: '2024-03-20', 
                    score: 92,
                    notes: 'Sangat kreatif dalam produksi multimedia'
                }
            ];

            sarprasData = [
                {
                    id: 1,
                    code: 'SP001',
                    name: 'Ruang Kelas X-1',
                    category: 'Ruang Kelas',
                    location: 'Lantai 1, Gedung A',
                    condition: 'Baik',
                    area: 64,
                    fundingSource: 'APBN',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Ruang kelas standar dengan kapasitas 32 siswa'
                },
                {
                    id: 2,
                    code: 'SP002',
                    name: 'Laboratorium Komputer',
                    category: 'Laboratorium',
                    location: 'Lantai 2, Gedung B',
                    condition: 'Baik',
                    area: 96,
                    fundingSource: 'DAK',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Lab komputer dengan 30 unit PC dan AC'
                },
                {
                    id: 3,
                    code: 'SP003',
                    name: 'Bengkel Otomotif',
                    category: 'Bengkel',
                    location: 'Gedung C',
                    condition: 'Baik',
                    area: 200,
                    fundingSource: 'BOS',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Bengkel otomotif lengkap dengan lift mobil'
                },
                {
                    id: 4,
                    code: 'SP004',
                    name: 'Perpustakaan',
                    category: 'Perpustakaan',
                    location: 'Lantai 1, Gedung A',
                    condition: 'Baik',
                    area: 120,
                    fundingSource: 'APBD',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Perpustakaan dengan koleksi 5000 buku'
                },
                {
                    id: 5,
                    code: 'SP005',
                    name: 'Aula Serbaguna',
                    category: 'Aula',
                    location: 'Gedung D',
                    condition: 'Baik',
                    area: 300,
                    fundingSource: 'Hibah',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Aula dengan kapasitas 500 orang, dilengkapi sound system'
                },
                {
                    id: 6,
                    code: 'SP006',
                    name: 'Lapangan Basket',
                    category: 'Lapangan',
                    location: 'Area Olahraga',
                    condition: 'Perlu Perbaikan',
                    area: 420,
                    fundingSource: 'Swadaya',
                    dateAdded: '2024-01-01',
                    photo: '',
                    description: 'Lapangan basket outdoor, cat lapangan mulai pudar'
                }
            ];
        }

        // Tab functionality
        function showTab(tabName) {
            // Check permission
            if (!rolePermissions[currentUser.role].includes(tabName)) {
                alert('Anda tidak memiliki akses ke menu ini!');
                return;
            }
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-600', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab
            const tabElement = document.getElementById(tabName);
            if (tabElement) {
                tabElement.classList.remove('hidden');
                tabElement.classList.add('fade-in');
            }
            
            // Add active class to clicked button
            const activeBtn = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'border-blue-600', 'text-blue-600');
                activeBtn.classList.remove('border-transparent', 'text-gray-500');
            }
        }

        // Update dashboard statistics
        function updateDashboard() {
            const filteredEquipment = filterDataByMajor(equipment, 'category');
            const filteredReports = filterDataByMajor(practiceReports, 'class');
            const filteredMaintenance = filterDataByMajor(maintenanceRecords, 'equipmentCategory');
            const filteredUKK = filterDataByMajor(competencyDocuments, 'major');
            
            const stats = {
                totalEquipment: filteredEquipment.length,
                goodCondition: filteredEquipment.filter(e => e.condition === 'Baik').length,
                needRepair: filteredEquipment.filter(e => e.condition === 'Perlu Perbaikan').length,
                totalReports: filteredReports.length,
                totalMaintenance: filteredMaintenance.length,
                totalUKK: filteredUKK.length,
                passedUKK: filteredUKK.filter(c => c.status === 'Lulus').length,
                totalSarpras: sarprasData.length,
                totalArea: sarprasData.reduce((sum, s) => sum + s.area, 0)
            };
            
            Object.keys(stats).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (key === 'totalArea') {
                        element.textContent = `${stats[key]} m¬≤`;
                    } else {
                        element.textContent = stats[key];
                    }
                }
            });
        }

        // Render sarpras table
        function renderSarprasTable() {
            const tbody = document.getElementById('sarprasTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            sarprasData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${item.photo ? `<img src="${item.photo}" class="image-preview rounded-lg" alt="Foto ${item.name}">` : '<div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xs">No Photo</div>'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.location}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(item.condition)}">
                            ${item.condition}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${item.fundingSource || '-'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(item.dateAdded)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewDetail('sarpras', ${item.id})" class="text-blue-600 hover:text-blue-900 mr-3">Lihat Detail</button>
                        ${currentUser.role === 'admin' || currentUser.role === 'waka_sarpras' ? `<button onclick="deleteSarpras(${item.id})" class="text-red-600 hover:text-red-900">Hapus</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render all data
        function renderAllData() {
            renderEquipmentTable();
            renderScheduleTable();
            renderPracticeReports();
            renderMaintenanceList();
            renderCompetencyDocuments();
            renderSarprasTable();
            renderMasterData();
        }

        // Populate selects
        function populateSelects() {
            populateCategories();
            populateMajors();
            populateSubjects();
            populateClasses();
            populateYears();
            populateEquipmentSelects();
        }

        // Populate categories
        function populateCategories() {
            const selects = ['equipmentCategory'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Kategori</option>';
                    
                    // For Waka role, only show general infrastructure categories
                    let categoriesToShow = categories;
                    if (currentUser && currentUser.role === 'waka_sarpras') {
                        categoriesToShow = getWakaCategories();
                    }
                    
                    categoriesToShow.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Populate majors
        function populateMajors() {
            const selects = ['competencyMajor', 'equipmentMajor'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Jurusan</option>';
                    majors.forEach(major => {
                        const option = document.createElement('option');
                        option.value = major.code;
                        option.textContent = `${major.code} - ${major.name}`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Populate subjects
        function populateSubjects() {
            const selects = ['scheduleSubject', 'reportSubject'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Mata Pelajaran</option>';
                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Populate classes
        function populateClasses() {
            const selects = ['scheduleClass', 'reportClass', 'equipmentClass'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Kelas</option>';
                    classes.forEach(className => {
                        const option = document.createElement('option');
                        option.value = className;
                        option.textContent = className;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Populate years
        function populateYears() {
            const selects = ['equipmentYear', 'maintenanceYear'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Tahun</option>';
                    const currentYear = new Date().getFullYear();
                    const startYear = 1999; // Start from 1999
                    const endYear = currentYear + 10; // Extend to 10 years in the future
                    
                    for (let year = endYear; year >= startYear; year--) {
                        const option = document.createElement('option');
                        option.value = year.toString();
                        option.textContent = year.toString();
                        select.appendChild(option);
                    }
                }
            });
        }

        // Populate equipment selects
        function populateEquipmentSelects() {
            const selects = ['scheduleEquipment', 'maintenanceEquipment'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Pilih Peralatan</option>';
                    const filteredEquipment = filterDataByMajor(equipment, 'category');
                    filteredEquipment.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = `${item.code} - ${item.name}`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Render equipment table
        function renderEquipmentTable() {
            const tbody = document.getElementById('equipmentTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const filteredEquipment = filterDataByMajor(equipment, 'category');
            filteredEquipment.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${item.photo ? `<img src="${item.photo}" class="image-preview rounded-lg" alt="Foto ${item.name}">` : '<div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xs">No Photo</div>'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" title="${item.specification || '-'}">
                        ${item.specification ? (item.specification.length > 20 ? item.specification.substring(0, 20) + '...' : item.specification) : '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium">${item.major || '-'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(item.condition)}">
                            ${item.condition}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${item.fundingSource || '-'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full font-medium">${item.year || '-'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewDetail('equipment', ${item.id})" class="text-blue-600 hover:text-blue-900 mr-3">Lihat Detail</button>
                        ${currentUser.role === 'admin' || currentUser.role === 'kabeng' ? `<button onclick="deleteEquipment(${item.id})" class="text-red-600 hover:text-red-900">Hapus</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render schedule table
        function renderScheduleTable() {
            const tbody = document.getElementById('scheduleTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const filteredSchedules = filterDataByMajor(schedules, 'class');
            filteredSchedules.forEach(schedule => {
                const equipment_item = equipment.find(e => e.id === schedule.equipmentId);
                const equipmentName = equipment_item ? `${equipment_item.code} - ${equipment_item.name}` : 'Unknown';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${equipmentName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${schedule.class}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${schedule.subject}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(schedule.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${schedule.time}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${schedule.teacher}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewDetail('schedule', ${schedule.id})" class="text-blue-600 hover:text-blue-900 mr-3">Lihat Detail</button>
                        ${currentUser.role === 'admin' || currentUser.role === 'kabeng' ? `<button onclick="deleteSchedule(${schedule.id})" class="text-red-600 hover:text-red-900">Hapus</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Add equipment item to form
        function addEquipmentItem() {
            const container = document.getElementById('equipmentUsedContainer');
            const newItem = document.createElement('div');
            newItem.className = 'equipment-item grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-3 bg-gray-50 rounded-lg';
            newItem.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Alat</label>
                    <select class="equipment-select w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="">Pilih Alat</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi Awal</label>
                    <select class="condition-before w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="Baik">Baik</option>
                        <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                        <option value="Rusak">Rusak</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kondisi Akhir</label>
                    <select class="condition-after w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="Baik">Baik</option>
                        <option value="Perlu Perbaikan">Perlu Perbaikan</option>
                        <option value="Rusak">Rusak</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="button" onclick="removeEquipmentItem(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">Hapus</button>
                </div>
            `;
            container.appendChild(newItem);
            
            // Populate equipment select for new item
            const select = newItem.querySelector('.equipment-select');
            equipment.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.code} - ${item.name}`;
                select.appendChild(option);
            });
        }

        function removeEquipmentItem(button) {
            button.closest('.equipment-item').remove();
        }

        function addMaterialItem() {
            const container = document.getElementById('materialsUsedContainer');
            const newItem = document.createElement('div');
            newItem.className = 'material-item grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-3 bg-gray-50 rounded-lg';
            newItem.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Bahan</label>
                    <input type="text" class="material-name w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="Contoh: Kawat tembaga">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah</label>
                    <input type="number" class="material-quantity w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" min="0" step="0.1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Satuan</label>
                    <select class="material-unit w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="pcs">Pcs</option>
                        <option value="meter">Meter</option>
                        <option value="kg">Kg</option>
                        <option value="liter">Liter</option>
                        <option value="gram">Gram</option>
                        <option value="cm">Cm</option>
                        <option value="mm">Mm</option>
                        <option value="set">Set</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="button" onclick="removeMaterialItem(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">Hapus</button>
                </div>
            `;
            container.appendChild(newItem);
        }

        function removeMaterialItem(button) {
            button.closest('.material-item').remove();
        }

        // Filter practice reports
        function filterPracticeReports() {
            const classFilter = document.getElementById('filterClass').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const subjectFilter = document.getElementById('filterSubject').value;
            const studentSearch = document.getElementById('searchStudent').value.toLowerCase();
            
            let filteredReports = practiceReports;
            
            if (classFilter) {
                filteredReports = filteredReports.filter(report => report.class === classFilter);
            }
            
            if (statusFilter) {
                filteredReports = filteredReports.filter(report => report.status === statusFilter);
            }
            
            if (subjectFilter) {
                filteredReports = filteredReports.filter(report => report.subject === subjectFilter);
            }
            
            if (studentSearch) {
                filteredReports = filteredReports.filter(report => 
                    report.student.toLowerCase().includes(studentSearch)
                );
            }
            
            renderFilteredPracticeReports(filteredReports);
        }

        function renderFilteredPracticeReports(reports) {
            const container = document.getElementById('practiceReports');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Apply major filtering first
            const filteredReports = filterDataByMajor(reports, 'class');
            
            if (filteredReports.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-gray-400 text-6xl mb-4">üìù</div>
                        <p class="text-gray-500">Tidak ada laporan praktik yang ditemukan</p>
                    </div>
                `;
                return;
            }
            
            filteredReports.forEach(report => {
                const reportElement = document.createElement('div');
                reportElement.className = 'bg-white border border-gray-200 rounded-lg p-6 card-hover shadow-sm';
                
                const equipmentList = report.equipmentUsed ? report.equipmentUsed.map(eq => {
                    const equipmentItem = equipment.find(e => e.id === eq.equipmentId);
                    return equipmentItem ? equipmentItem.name : 'Unknown';
                }).join(', ') : 'Tidak ada data';
                
                const materialsList = report.materialsUsed ? report.materialsUsed.map(mat => 
                    `${mat.name} (${mat.quantity} ${mat.unit})`
                ).join(', ') : 'Tidak ada data';
                
                reportElement.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-900 mb-1">${report.student}</h4>
                            <p class="text-sm text-gray-600">NIS: ${report.nis || '-'} | Kelas: ${report.class}</p>
                        </div>
                        <span class="px-3 py-1 ${getStatusColor(report.status)} text-xs rounded-full font-medium">${report.status}</span>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="font-medium text-gray-900 mb-2">${report.title}</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                            <div>
                                <p><strong>Mata Pelajaran:</strong> ${report.subject}</p>
                                <p><strong>Guru:</strong> ${report.teacher || '-'}</p>
                                <p><strong>Tanggal:</strong> ${formatDate(report.date)}</p>
                                <p><strong>Waktu:</strong> ${report.startTime || '-'} - ${report.endTime || '-'}</p>
                            </div>
                            <div>
                                <p><strong>Nilai:</strong> <span class="text-lg font-bold ${report.score >= 75 ? 'text-green-600' : report.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">${report.score}</span> ${report.grade ? `(${report.grade})` : ''}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <h6 class="font-medium text-gray-900 mb-2 text-sm">Alat yang Digunakan:</h6>
                        <p class="text-xs text-gray-600">${equipmentList}</p>
                    </div>
                    
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <h6 class="font-medium text-gray-900 mb-2 text-sm">Bahan yang Digunakan:</h6>
                        <p class="text-xs text-gray-600">${materialsList}</p>
                    </div>
                    
                    ${report.objective ? `
                    <div class="mb-4">
                        <h6 class="font-medium text-gray-900 mb-1 text-sm">Tujuan Praktik:</h6>
                        <p class="text-xs text-gray-600">${report.objective.substring(0, 100)}${report.objective.length > 100 ? '...' : ''}</p>
                    </div>
                    ` : ''}
                    
                    <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                        <button onclick="viewDetail('report', ${report.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">üìÑ Lihat Detail Lengkap</button>
                        <div class="space-x-2">
                            <button onclick="exportReportPDF(${report.id})" class="text-green-600 hover:text-green-800 text-sm">üìÑ Export PDF</button>
                            ${currentUser.role === 'admin' || currentUser.role === 'kekom' ? `<button onclick="deleteReport(${report.id})" class="text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Hapus</button>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(reportElement);
            });
        }

        // Render practice reports
        function renderPracticeReports() {
            // Populate filter options
            populateFilterOptions();
            
            // Render all reports initially
            renderFilteredPracticeReports(practiceReports);
        }

        function populateFilterOptions() {
            // Populate class filter
            const classFilter = document.getElementById('filterClass');
            if (classFilter) {
                const uniqueClasses = [...new Set(practiceReports.map(r => r.class))];
                classFilter.innerHTML = '<option value="">Semua Kelas</option>';
                uniqueClasses.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    classFilter.appendChild(option);
                });
            }
            
            // Populate subject filter
            const subjectFilter = document.getElementById('filterSubject');
            if (subjectFilter) {
                const uniqueSubjects = [...new Set(practiceReports.map(r => r.subject))];
                subjectFilter.innerHTML = '<option value="">Semua Mata Pelajaran</option>';
                uniqueSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectFilter.appendChild(option);
                });
            }
        }

        // Render maintenance list
        function renderMaintenanceList() {
            const container = document.getElementById('maintenanceList');
            if (!container) return;
            
            container.innerHTML = '';
            
            maintenanceRecords.forEach(record => {
                const equipment_item = equipment.find(e => e.id === record.equipmentId);
                const equipmentName = equipment_item ? equipment_item.name : 'Unknown';
                
                const recordElement = document.createElement('div');
                recordElement.className = 'bg-gray-50 rounded-lg p-4 card-hover';
                recordElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 mb-1">${record.type}</h4>
                            <p class="text-sm text-gray-600 mb-1">Peralatan: ${equipmentName}</p>
                            <p class="text-sm text-gray-600 mb-1">Deskripsi: ${record.description}</p>
                            <p class="text-sm text-gray-600 mb-1">Teknisi: ${record.technician}</p>
                            <div class="grid grid-cols-2 gap-2 mb-2">
                                <p class="text-sm text-gray-600">Biaya: ${formatCurrency(record.cost)}</p>
                                <p class="text-sm text-gray-600">Tahun: ${record.year || '-'}</p>
                                <p class="text-sm text-gray-600">Sumber Dana: <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${record.fundingSource || '-'}</span></p>
                                <p class="text-sm text-gray-500">Tanggal: ${formatDate(record.date)}</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="px-2 py-1 ${getStatusColor(record.status)} text-xs rounded-full">${record.status}</span>
                                <div class="space-x-2">
                                    <button onclick="viewDetail('maintenance', ${record.id})" class="text-blue-600 hover:text-blue-800 text-sm">Lihat Detail</button>
                                    ${currentUser.role === 'admin' || currentUser.role === 'kabeng' || currentUser.role === 'waka_sarpras' ? `<button onclick="deleteMaintenance(${record.id})" class="text-red-600 hover:text-red-800 text-sm">Hapus</button>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(recordElement);
            });
        }

        // Render competency documents
        function renderCompetencyDocuments() {
            const container = document.getElementById('competencyDocuments');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Filter documents based on user role
            const filteredDocs = filterDataByMajor(competencyDocuments, 'major');
            
            if (filteredDocs.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-gray-400 text-6xl mb-4">üèÜ</div>
                        <p class="text-gray-500">Tidak ada dokumen UKK & kompetensi yang ditemukan</p>
                    </div>
                `;
                return;
            }
            
            filteredDocs.forEach(doc => {
                const docElement = document.createElement('div');
                docElement.className = 'bg-gray-50 rounded-lg p-4 card-hover';
                docElement.innerHTML = `
                    <h4 class="font-semibold text-gray-900 mb-2">${doc.student}</h4>
                    <p class="text-sm text-gray-600 mb-1">Jurusan: ${doc.major}</p>
                    <p class="text-sm text-gray-600 mb-1">Kompetensi: ${doc.competency}</p>
                    <p class="text-sm text-gray-600 mb-2">Tanggal UKK: ${formatDate(doc.date)}</p>
                    <div class="flex justify-between items-center mb-2">
                        <span class="px-2 py-1 ${getStatusColor(doc.status)} text-xs rounded-full">${doc.status}</span>
                        <span class="text-lg font-bold text-red-600">Nilai: ${doc.score}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <button onclick="viewDetail('competency', ${doc.id})" class="text-blue-600 hover:text-blue-800 text-sm">Lihat Detail</button>
                        <div class="space-x-2">
                            ${doc.status === 'Lulus' ? `<button onclick="downloadCertificate(${doc.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs">Download Sertifikat</button>` : ''}
                            ${currentUser.role === 'admin' || currentUser.role === 'kekom' ? `<button onclick="deleteCompetency(${doc.id})" class="text-red-600 hover:text-red-800 text-xs">Hapus</button>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(docElement);
            });
        }

        // Render master data
        function renderMasterData() {
            if (currentUser.role !== 'admin') return;
            
            // Render categories
            const categoryList = document.getElementById('categoryList');
            if (categoryList) {
                categoryList.innerHTML = '';
                categories.forEach((category, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-white rounded border';
                    item.innerHTML = `
                        <span>${category}</span>
                        <button onclick="deleteCategory(${index})" class="text-red-600 hover:text-red-800 text-sm">Hapus</button>
                    `;
                    categoryList.appendChild(item);
                });
            }
            
            // Render majors
            const majorList = document.getElementById('majorList');
            if (majorList) {
                majorList.innerHTML = '';
                majors.forEach((major, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-white rounded border';
                    item.innerHTML = `
                        <span>${major.code} - ${major.name}</span>
                        <button onclick="deleteMajor(${index})" class="text-red-600 hover:text-red-800 text-sm">Hapus</button>
                    `;
                    majorList.appendChild(item);
                });
            }
            
            // Render subjects
            const subjectList = document.getElementById('subjectList');
            if (subjectList) {
                subjectList.innerHTML = '';
                subjects.forEach((subject, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-white rounded border';
                    item.innerHTML = `
                        <span>${subject}</span>
                        <button onclick="deleteSubject(${index})" class="text-red-600 hover:text-red-800 text-sm">Hapus</button>
                    `;
                    subjectList.appendChild(item);
                });
            }
            
            // Render classes
            const classList = document.getElementById('classList');
            if (classList) {
                classList.innerHTML = '';
                classes.forEach((className, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-white rounded border';
                    item.innerHTML = `
                        <span>${className}</span>
                        <button onclick="deleteClass(${index})" class="text-red-600 hover:text-red-800 text-sm">Hapus</button>
                    `;
                    classList.appendChild(item);
                });
            }
        }

        // Get condition color class
        function getConditionColor(condition) {
            switch(condition) {
                case 'Baik': return 'bg-green-100 text-green-800';
                case 'Perlu Perbaikan': return 'bg-yellow-100 text-yellow-800';
                case 'Rusak': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Get status color class
        function getStatusColor(status) {
            switch(status) {
                case 'Selesai': 
                case 'Lulus': return 'bg-green-100 text-green-800';
                case 'Dalam Proses': return 'bg-yellow-100 text-yellow-800';
                case 'Tidak Lulus':
                case 'Belum Mulai': return 'bg-red-100 text-red-800';
                case 'Mengulang':
                case 'Dijadwalkan': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID');
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR'
            }).format(amount);
        }

        // View detail function
        function viewDetail(type, id) {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('detailContent');
            
            let item;
            let html = '';
            
            switch(type) {
                case 'equipment':
                    item = equipment.find(e => e.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    html = `
                        <div class="space-y-6">
                            <div class="text-center">
                                ${item.photo ? `<img src="${item.photo}" class="w-48 h-48 object-cover rounded-lg mx-auto shadow-lg" alt="Foto ${item.name}">` : '<div class="w-48 h-48 bg-gray-200 rounded-lg mx-auto flex items-center justify-center text-gray-400"><span class="text-4xl">üì¶</span></div>'}
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Informasi Peralatan</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kode:</span>
                                        <span class="text-gray-900">${item.code}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Nama:</span>
                                        <span class="text-gray-900">${item.name}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kategori:</span>
                                        <span class="text-gray-900">${item.category}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Jurusan:</span>
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium">${item.major || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kondisi:</span>
                                        <span class="px-2 py-1 ${getConditionColor(item.condition)} text-xs rounded-full font-medium">${item.condition}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Sumber Dana:</span>
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${item.fundingSource || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tahun Pengadaan:</span>
                                        <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full font-medium">${item.year || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal Masuk:</span>
                                        <span class="text-gray-900">${formatDate(item.dateAdded)}</span>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Spesifikasi:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.specification || 'Tidak ada spesifikasi'}</p>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Deskripsi:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.description || 'Tidak ada deskripsi'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'schedule':
                    item = schedules.find(s => s.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    const equipment_item = equipment.find(e => e.id === item.equipmentId);
                    html = `
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Detail Jadwal Penggunaan</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Peralatan:</span>
                                        <span class="text-gray-900">${equipment_item ? `${equipment_item.code} - ${equipment_item.name}` : 'Peralatan tidak ditemukan'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kelas:</span>
                                        <span class="text-gray-900">${item.class}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Mata Pelajaran:</span>
                                        <span class="text-gray-900">${item.subject}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Guru:</span>
                                        <span class="text-gray-900">${item.teacher}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal:</span>
                                        <span class="text-gray-900">${formatDate(item.date)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Waktu:</span>
                                        <span class="text-gray-900">${item.time}</span>
                                    </div>
                                </div>
                                ${equipment_item ? `
                                <div class="mt-4 p-3 bg-blue-50 rounded border border-blue-200">
                                    <h5 class="font-medium text-blue-900 mb-2">Informasi Peralatan</h5>
                                    <p class="text-sm text-blue-800">Kondisi: <span class="px-2 py-1 ${getConditionColor(equipment_item.condition)} text-xs rounded-full">${equipment_item.condition}</span></p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    break;
                case 'report':
                    item = practiceReports.find(r => r.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    
                    // Equipment used details
                    let equipmentDetails = '';
                    if (item.equipmentUsed && item.equipmentUsed.length > 0) {
                        equipmentDetails = item.equipmentUsed.map(eq => {
                            const equipmentItem = equipment.find(e => e.id === eq.equipmentId);
                            const equipmentName = equipmentItem ? `${equipmentItem.code} - ${equipmentItem.name}` : 'Unknown Equipment';
                            return `
                                <div class="flex justify-between items-center p-2 bg-white rounded border">
                                    <span class="font-medium">${equipmentName}</span>
                                    <div class="text-sm">
                                        <span class="px-2 py-1 ${getConditionColor(eq.conditionBefore)} text-xs rounded mr-1">Awal: ${eq.conditionBefore}</span>
                                        <span class="px-2 py-1 ${getConditionColor(eq.conditionAfter)} text-xs rounded">Akhir: ${eq.conditionAfter}</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    } else {
                        equipmentDetails = '<p class="text-gray-500 text-sm">Tidak ada data alat yang digunakan</p>';
                    }
                    
                    // Materials used details
                    let materialsDetails = '';
                    if (item.materialsUsed && item.materialsUsed.length > 0) {
                        materialsDetails = item.materialsUsed.map(mat => `
                            <div class="flex justify-between items-center p-2 bg-white rounded border">
                                <span class="font-medium">${mat.name}</span>
                                <span class="text-sm text-gray-600">${mat.quantity} ${mat.unit}</span>
                            </div>
                        `).join('');
                    } else {
                        materialsDetails = '<p class="text-gray-500 text-sm">Tidak ada data bahan yang digunakan</p>';
                    }
                    
                    html = `
                        <div class="space-y-6">
                            <!-- Basic Information -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Informasi Dasar</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Nama Siswa:</span>
                                        <span class="text-gray-900">${item.student}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">NIS:</span>
                                        <span class="text-gray-900">${item.nis || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kelas:</span>
                                        <span class="text-gray-900">${item.class}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Guru Pembimbing:</span>
                                        <span class="text-gray-900">${item.teacher || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Mata Pelajaran:</span>
                                        <span class="text-gray-900">${item.subject}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal:</span>
                                        <span class="text-gray-900">${formatDate(item.date)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Waktu:</span>
                                        <span class="text-gray-900">${item.startTime || '-'} - ${item.endTime || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Status:</span>
                                        <span class="px-2 py-1 ${getStatusColor(item.status)} text-xs rounded-full font-medium">${item.status}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Practice Title -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-2 text-blue-900">Judul Praktik</h4>
                                <p class="text-blue-800">${item.title}</p>
                            </div>

                            <!-- Equipment Used -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Alat yang Digunakan</h4>
                                <div class="space-y-2">
                                    ${equipmentDetails}
                                </div>
                            </div>

                            <!-- Materials Used -->
                            <div class="bg-green-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-green-900">Bahan yang Digunakan</h4>
                                <div class="space-y-2">
                                    ${materialsDetails}
                                </div>
                            </div>

                            <!-- Practice Details -->
                            ${item.objective || item.procedure || item.result || item.conclusion ? `
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-purple-900">Detail Praktik</h4>
                                <div class="space-y-4">
                                    ${item.objective ? `
                                    <div>
                                        <h6 class="font-medium text-purple-800 mb-1">Tujuan Praktik:</h6>
                                        <p class="text-purple-700 text-sm bg-white p-3 rounded border">${item.objective}</p>
                                    </div>
                                    ` : ''}
                                    ${item.procedure ? `
                                    <div>
                                        <h6 class="font-medium text-purple-800 mb-1">Langkah Kerja:</h6>
                                        <p class="text-purple-700 text-sm bg-white p-3 rounded border whitespace-pre-line">${item.procedure}</p>
                                    </div>
                                    ` : ''}
                                    ${item.result ? `
                                    <div>
                                        <h6 class="font-medium text-purple-800 mb-1">Hasil Praktik:</h6>
                                        <p class="text-purple-700 text-sm bg-white p-3 rounded border">${item.result}</p>
                                    </div>
                                    ` : ''}
                                    ${item.conclusion ? `
                                    <div>
                                        <h6 class="font-medium text-purple-800 mb-1">Kesimpulan:</h6>
                                        <p class="text-purple-700 text-sm bg-white p-3 rounded border">${item.conclusion}</p>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            ` : ''}

                            <!-- Assessment -->
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-yellow-900">Penilaian</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div class="text-center">
                                        <p class="text-sm text-yellow-700 mb-1">Nilai Praktik</p>
                                        <p class="text-3xl font-bold ${item.score >= 75 ? 'text-green-600' : item.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">${item.score}</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-sm text-yellow-700 mb-1">Grade</p>
                                        <p class="text-2xl font-bold text-yellow-800">${item.grade || '-'}</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-sm text-yellow-700 mb-1">Kategori</p>
                                        <p class="text-sm font-medium ${item.score >= 75 ? 'text-green-600' : item.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                                            ${item.score >= 75 ? 'Sangat Baik' : item.score >= 60 ? 'Baik' : 'Perlu Perbaikan'}
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="h-3 rounded-full ${item.score >= 75 ? 'bg-green-500' : item.score >= 60 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${item.score}%"></div>
                                    </div>
                                </div>
                                ${item.notes ? `
                                <div>
                                    <h6 class="font-medium text-yellow-800 mb-2">Catatan Guru:</h6>
                                    <p class="text-yellow-700 text-sm bg-white p-3 rounded border">${item.notes}</p>
                                </div>
                                ` : ''}
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex justify-center space-x-4 pt-4">
                                <button onclick="exportReportPDF(${item.id})" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                                    üìÑ Export PDF
                                </button>
                                <button onclick="hideDetailModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                                    Tutup
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                case 'maintenance':
                    item = maintenanceRecords.find(m => m.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    const maintenance_equipment = equipment.find(e => e.id === item.equipmentId);
                    html = `
                        <div class="space-y-6">
                            <div class="text-center">
                                ${item.photo ? `<img src="${item.photo}" class="w-48 h-48 object-cover rounded-lg mx-auto shadow-lg" alt="Foto Pemeliharaan">` : '<div class="w-48 h-48 bg-gray-200 rounded-lg mx-auto flex items-center justify-center text-gray-400"><span class="text-4xl">üîß</span></div>'}
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Detail Pemeliharaan</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Peralatan:</span>
                                        <span class="text-gray-900">${maintenance_equipment ? `${maintenance_equipment.code} - ${maintenance_equipment.name}` : 'Peralatan tidak ditemukan'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Jenis Pemeliharaan:</span>
                                        <span class="text-gray-900">${item.type}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Status:</span>
                                        <span class="px-2 py-1 ${getStatusColor(item.status)} text-xs rounded-full font-medium">${item.status}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Teknisi:</span>
                                        <span class="text-gray-900">${item.technician}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal:</span>
                                        <span class="text-gray-900">${formatDate(item.date)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tahun:</span>
                                        <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full font-medium">${item.year || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Biaya:</span>
                                        <span class="text-lg font-bold text-orange-600">${formatCurrency(item.cost)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Sumber Dana:</span>
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${item.fundingSource || '-'}</span>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Deskripsi Pekerjaan:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.description}</p>
                                </div>
                                ${maintenance_equipment ? `
                                <div class="mt-4 p-3 bg-orange-50 rounded border border-orange-200">
                                    <h5 class="font-medium text-orange-900 mb-2">Status Peralatan Setelah Pemeliharaan</h5>
                                    <p class="text-sm text-orange-800">Kondisi: <span class="px-2 py-1 ${getConditionColor(maintenance_equipment.condition)} text-xs rounded-full">${maintenance_equipment.condition}</span></p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    break;
                case 'sarpras':
                    item = sarprasData.find(s => s.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    html = `
                        <div class="space-y-6">
                            <div class="text-center">
                                ${item.photo ? `<img src="${item.photo}" class="w-48 h-48 object-cover rounded-lg mx-auto shadow-lg" alt="Foto ${item.name}">` : '<div class="w-48 h-48 bg-gray-200 rounded-lg mx-auto flex items-center justify-center text-gray-400"><span class="text-4xl">üè¢</span></div>'}
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Informasi Sarana Prasarana</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kode:</span>
                                        <span class="text-gray-900">${item.code}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Nama:</span>
                                        <span class="text-gray-900">${item.name}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kategori:</span>
                                        <span class="text-gray-900">${item.category}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Lokasi:</span>
                                        <span class="text-gray-900">${item.location}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kondisi:</span>
                                        <span class="px-2 py-1 ${getConditionColor(item.condition)} text-xs rounded-full font-medium">${item.condition}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Luas:</span>
                                        <span class="text-gray-900">${item.area} m¬≤</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Sumber Dana:</span>
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">${item.fundingSource || '-'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal Inventarisasi:</span>
                                        <span class="text-gray-900">${formatDate(item.dateAdded)}</span>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Spesifikasi:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.specification || 'Tidak ada spesifikasi'}</p>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Deskripsi:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.description || 'Tidak ada deskripsi'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'competency':
                    item = competencyDocuments.find(c => c.id === id);
                    if (!item) {
                        alert('Data tidak ditemukan!');
                        return;
                    }
                    const majorInfo = majors.find(m => m.code === item.major);
                    html = `
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-900">Detail UKK & Kompetensi</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Nama Siswa:</span>
                                        <span class="text-gray-900">${item.student}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Jurusan:</span>
                                        <span class="text-gray-900">${majorInfo ? `${item.major} - ${majorInfo.name}` : item.major}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Kompetensi:</span>
                                        <span class="text-gray-900">${item.competency}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Status:</span>
                                        <span class="px-2 py-1 ${getStatusColor(item.status)} text-xs rounded-full font-medium">${item.status}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-600">Tanggal UKK:</span>
                                        <span class="text-gray-900">${formatDate(item.date)}</span>
                                    </div>
                                </div>
                                <div class="mt-4 p-4 bg-white rounded border">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium text-gray-600">Nilai UKK:</span>
                                        <span class="text-3xl font-bold ${item.score >= 75 ? 'text-green-600' : item.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">${item.score}</span>
                                    </div>
                                    <div class="mt-2">
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="h-2 rounded-full ${item.score >= 75 ? 'bg-green-500' : item.score >= 60 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${item.score}%"></div>
                                        </div>
                                        <p class="text-sm text-gray-500 mt-1">
                                            ${item.score >= 75 ? 'Sangat Kompeten' : item.score >= 60 ? 'Kompeten' : 'Belum Kompeten'}
                                        </p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <span class="font-medium text-gray-600">Catatan Penguji:</span>
                                    <p class="mt-1 text-gray-900 bg-white p-3 rounded border">${item.notes || 'Tidak ada catatan khusus'}</p>
                                </div>
                                ${item.status === 'Lulus' ? `
                                <div class="mt-4 p-3 bg-green-50 rounded border border-green-200">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h5 class="font-medium text-green-900">Sertifikat Kompetensi</h5>
                                            <p class="text-sm text-green-700">Siswa telah lulus dan berhak mendapat sertifikat</p>
                                        </div>
                                        <button onclick="downloadCertificate(${item.id})" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                            üìÑ Download Sertifikat
                                        </button>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    break;
            }
            
            content.innerHTML = html;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Download certificate
        function downloadCertificate(id) {
            const doc = competencyDocuments.find(c => c.id === id);
            if (!doc) {
                alert('Data sertifikat tidak ditemukan!');
                return;
            }
            
            if (doc.status !== 'Lulus') {
                alert('Sertifikat hanya dapat diunduh untuk siswa yang lulus UKK!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('landscape', 'mm', 'a4');
            
            // Background border
            pdf.setDrawColor(0, 0, 0);
            pdf.setLineWidth(2);
            pdf.rect(10, 10, 277, 190);
            pdf.setLineWidth(1);
            pdf.rect(15, 15, 267, 180);
            
            // Header
            pdf.setFontSize(24);
            pdf.setFont('helvetica', 'bold');
            pdf.text('SERTIFIKAT KOMPETENSI KEAHLIAN', 148.5, 35, { align: 'center' });
            
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'normal');
            pdf.text('SMK NEGERI 1 KEFAMENANU', 148.5, 50, { align: 'center' });
            pdf.text('NUSA TENGGARA TIMUR', 148.5, 60, { align: 'center' });
            
            // Separator line
            pdf.setLineWidth(0.5);
            pdf.line(50, 70, 247, 70);
            
            // Certificate number
            pdf.setFontSize(10);
            pdf.text(`No. Sertifikat: UKK/${doc.major}/${new Date().getFullYear()}/${String(doc.id).padStart(3, '0')}`, 148.5, 80, { align: 'center' });
            
            // Main content
            pdf.setFontSize(14);
            pdf.text('Dengan ini menyatakan bahwa:', 148.5, 95, { align: 'center' });
            
            pdf.setFontSize(20);
            pdf.setFont('helvetica', 'bold');
            pdf.text(doc.student.toUpperCase(), 148.5, 110, { align: 'center' });
            
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'normal');
            const majorInfo = majors.find(m => m.code === doc.major);
            pdf.text(`Jurusan: ${majorInfo ? majorInfo.name : doc.major}`, 148.5, 125, { align: 'center' });
            
            pdf.text('Telah berhasil menyelesaikan', 148.5, 140, { align: 'center' });
            pdf.setFont('helvetica', 'bold');
            pdf.text('UJI KOMPETENSI KEAHLIAN', 148.5, 150, { align: 'center' });
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Bidang Kompetensi: ${doc.competency}`, 148.5, 160, { align: 'center' });
            
            // Score and grade
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            const grade = doc.score >= 85 ? 'SANGAT KOMPETEN' : doc.score >= 75 ? 'KOMPETEN' : 'CUKUP KOMPETEN';
            pdf.text(`Dengan nilai: ${doc.score} (${grade})`, 148.5, 175, { align: 'center' });
            
            // Date and signatures
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Kefamenanu, ${formatDate(doc.date)}`, 200, 190);
            
            // Left signature
            pdf.text('Ketua Penguji', 60, 190);
            pdf.text('_________________', 60, 205);
            pdf.text('NIP. ', 60, 210);
            
            // Right signature  
            pdf.text('Kepala Sekolah', 200, 190);
            pdf.text('_________________', 200, 205);
            pdf.text('NIP. ', 200, 210);
            
            // Footer
            pdf.setFontSize(8);
            pdf.text('Sertifikat ini diterbitkan sebagai bukti kelulusan Uji Kompetensi Keahlian', 148.5, 220, { align: 'center' });
            pdf.text('sesuai dengan Standar Kompetensi Kerja Nasional Indonesia (SKKNI)', 148.5, 225, { align: 'center' });
            
            // Save the PDF
            pdf.save(`Sertifikat_UKK_${doc.student.replace(/\s+/g, '_')}_${doc.major}_${new Date().getFullYear()}.pdf`);
            
            // Add to recent activities
            addRecentActivity(`Sertifikat ${doc.student} berhasil diunduh`);
        }

        // Excel import/export functions
        function downloadTemplate(type) {
            const templates = {
                inventaris: [
                    ['Kode', 'Nama Peralatan', 'Kategori', 'Spesifikasi', 'Jurusan', 'Kelas', 'Kondisi', 'Sumber Dana', 'Tahun', 'Deskripsi'],
                    ['TKP001', 'Theodolite Digital', 'Alat Survei', 'Akurasi 2", Display LCD', 'TKP', 'XII TKP 1', 'Baik', 'DAK', '2023', 'Theodolite digital untuk praktik survei'],
                    ['TITL001', 'Multimeter Digital', 'Alat Ukur Listrik', 'True RMS, 6000 Count', 'TITL', 'XII TITL 1', 'Baik', 'BOS', '2023', 'Multimeter untuk pengukuran listrik'],
                    ['TKJ001', 'Switch 24 Port', 'Peralatan Jaringan', 'Gigabit Ethernet, Managed', 'TKJ', 'XII TKJ', 'Baik', 'APBD', '2022', 'Switch untuk praktik jaringan']
                ],
                jadwal: [
                    ['Kode Peralatan', 'Kelas', 'Mata Pelajaran', 'Guru', 'Tanggal', 'Waktu'],
                    ['TKP001', 'XII TKP 1', 'Konstruksi Bangunan', 'Pak Budi', '2024-03-15', '08:00'],
                    ['TKJ001', 'XI TKJ', 'Jaringan Komputer', 'Bu Sari', '2024-03-16', '10:00']
                ],
                praktik: [
                    ['Nama Siswa', 'Kelas', 'Judul Praktik', 'Mata Pelajaran', 'Tanggal', 'Status', 'Nilai'],
                    ['Ahmad Rizki', 'XII TKJ 1', 'Instalasi Jaringan', 'Jaringan Komputer', '2024-03-01', 'Selesai', '85']
                ],
                pemeliharaan: [
                    ['Kode Peralatan', 'Jenis Pemeliharaan', 'Status', 'Teknisi', 'Tanggal', 'Biaya', 'Deskripsi'],
                    ['TKP001', 'Kalibrasi', 'Selesai', 'Pak Budi', '2024-03-01', '250000', 'Kalibrasi theodolite digital'],
                    ['TITL001', 'Perawatan Rutin', 'Selesai', 'Pak Andi', '2024-03-05', '100000', 'Pembersihan dan kalibrasi multimeter']
                ],
                ukk: [
                    ['Nama Siswa', 'Jurusan', 'Kompetensi', 'Status', 'Tanggal UKK', 'Nilai', 'Catatan'],
                    ['Ahmad Rizki', 'TKJ', 'Administrasi Jaringan', 'Lulus', '2024-03-10', '85', 'Sangat baik']
                ],
                sarpras: [
                    ['Kode', 'Nama Sarana/Prasarana', 'Kategori', 'Lokasi', 'Kondisi', 'Luas (m¬≤)', 'Sumber Dana', 'Deskripsi'],
                    ['SP001', 'Ruang Kelas X-1', 'Ruang Kelas', 'Lantai 1, Gedung A', 'Baik', '64', 'APBN', 'Ruang kelas standar'],
                    ['SP002', 'Lab Komputer', 'Laboratorium', 'Lantai 2, Gedung B', 'Baik', '96', 'DAK', 'Lab dengan 30 PC']
                ]
            };
            
            const ws = XLSX.utils.aoa_to_sheet(templates[type]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, `Template_${type}.xlsx`);
        }

        function importExcel(type) {
            const fileInput = document.getElementById(`import${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // Skip header row
                const rows = jsonData.slice(1);
                
                rows.forEach(row => {
                    if (row.length === 0) return;
                    
                    switch(type) {
                        case 'inventaris':
                            if (row[0] && row[1]) {
                                equipment.push({
                                    id: equipment.length + 1,
                                    code: row[0],
                                    name: row[1],
                                    category: row[2] || 'Lainnya',
                                    specification: row[3] || '',
                                    major: row[4] || '',
                                    class: row[5] || '',
                                    condition: row[6] || 'Baik',
                                    fundingSource: row[7] || '',
                                    year: row[8] || '',
                                    dateAdded: new Date().toISOString().split('T')[0],
                                    photo: '',
                                    description: row[9] || ''
                                });
                            }
                            break;
                        case 'jadwal':
                            if (row[0] && row[1]) {
                                const equipmentItem = equipment.find(e => e.code === row[0]);
                                if (equipmentItem) {
                                    schedules.push({
                                        id: schedules.length + 1,
                                        equipmentId: equipmentItem.id,
                                        class: row[1],
                                        subject: row[2] || '',
                                        teacher: row[3] || '',
                                        date: row[4] || new Date().toISOString().split('T')[0],
                                        time: row[5] || '08:00'
                                    });
                                }
                            }
                            break;
                        case 'praktik':
                            if (row[0] && row[1]) {
                                practiceReports.push({
                                    id: practiceReports.length + 1,
                                    student: row[0],
                                    class: row[1],
                                    title: row[2] || '',
                                    subject: row[3] || '',
                                    date: row[4] || new Date().toISOString().split('T')[0],
                                    status: row[5] || 'Belum Mulai',
                                    score: parseInt(row[6]) || 0
                                });
                            }
                            break;
                        case 'pemeliharaan':
                            if (row[0] && row[1]) {
                                const equipmentItem = equipment.find(e => e.code === row[0]);
                                if (equipmentItem) {
                                    maintenanceRecords.push({
                                        id: maintenanceRecords.length + 1,
                                        equipmentId: equipmentItem.id,
                                        type: row[1],
                                        status: row[2] || 'Dijadwalkan',
                                        technician: row[3] || '',
                                        date: row[4] || new Date().toISOString().split('T')[0],
                                        cost: parseInt(row[5]) || 0,
                                        description: row[6] || ''
                                    });
                                }
                            }
                            break;
                        case 'ukk':
                            if (row[0] && row[1]) {
                                competencyDocuments.push({
                                    id: competencyDocuments.length + 1,
                                    student: row[0],
                                    major: row[1],
                                    competency: row[2] || '',
                                    status: row[3] || 'Belum Lulus',
                                    date: row[4] || new Date().toISOString().split('T')[0],
                                    score: parseInt(row[5]) || 0,
                                    notes: row[6] || ''
                                });
                            }
                            break;
                        case 'sarpras':
                            if (row[0] && row[1]) {
                                sarprasData.push({
                                    id: sarprasData.length + 1,
                                    code: row[0],
                                    name: row[1],
                                    category: row[2] || 'Lainnya',
                                    location: row[3] || '',
                                    condition: row[4] || 'Baik',
                                    area: parseInt(row[5]) || 0,
                                    fundingSource: row[6] || '',
                                    dateAdded: new Date().toISOString().split('T')[0],
                                    photo: '',
                                    description: row[7] || ''
                                });
                            }
                            break;
                    }
                });
                
                // Refresh displays
                renderAllData();
                updateDashboard();
                populateEquipmentSelects();
                
                addRecentActivity(`Data ${type} berhasil diimpor`);
                alert(`Data ${type} berhasil diimpor!`);
            };
            
            reader.readAsArrayBuffer(file);
        }

        function exportExcel(type) {
            let data = [];
            let headers = [];
            
            switch(type) {
                case 'inventaris':
                    headers = ['Kode', 'Nama Peralatan', 'Kategori', 'Spesifikasi', 'Jurusan', 'Kelas', 'Kondisi', 'Sumber Dana', 'Tahun', 'Tanggal Masuk', 'Deskripsi'];
                    data = equipment.map(item => [
                        item.code, item.name, item.category, item.specification || '-', item.major || '-', item.class || '-', item.condition, 
                        item.fundingSource || '-', item.year || '-', formatDate(item.dateAdded), item.description
                    ]);
                    break;
                case 'jadwal':
                    headers = ['Peralatan', 'Kelas', 'Mata Pelajaran', 'Guru', 'Tanggal', 'Waktu'];
                    data = schedules.map(schedule => {
                        const equipmentItem = equipment.find(e => e.id === schedule.equipmentId);
                        return [
                            equipmentItem ? equipmentItem.name : 'Unknown',
                            schedule.class, schedule.subject, schedule.teacher,
                            formatDate(schedule.date), schedule.time
                        ];
                    });
                    break;
                case 'praktik':
                    headers = ['Nama Siswa', 'Kelas', 'Judul Praktik', 'Mata Pelajaran', 'Tanggal', 'Status', 'Nilai'];
                    data = practiceReports.map(report => [
                        report.student, report.class, report.title, report.subject,
                        formatDate(report.date), report.status, report.score
                    ]);
                    break;
                case 'pemeliharaan':
                    headers = ['Peralatan', 'Jenis Pemeliharaan', 'Status', 'Teknisi', 'Tanggal', 'Biaya', 'Deskripsi'];
                    data = maintenanceRecords.map(record => {
                        const equipmentItem = equipment.find(e => e.id === record.equipmentId);
                        return [
                            equipmentItem ? equipmentItem.name : 'Unknown',
                            record.type, record.status, record.technician,
                            formatDate(record.date), record.cost, record.description
                        ];
                    });
                    break;
                case 'ukk':
                    headers = ['Nama Siswa', 'Jurusan', 'Kompetensi', 'Status', 'Tanggal UKK', 'Nilai', 'Catatan'];
                    data = competencyDocuments.map(doc => [
                        doc.student, doc.major, doc.competency, doc.status,
                        formatDate(doc.date), doc.score, doc.notes
                    ]);
                    break;
                case 'sarpras':
                    headers = ['Kode', 'Nama Sarana/Prasarana', 'Kategori', 'Lokasi', 'Kondisi', 'Luas (m¬≤)', 'Sumber Dana', 'Tanggal', 'Deskripsi'];
                    data = sarprasData.map(item => [
                        item.code, item.name, item.category, item.location, item.condition,
                        item.area, item.fundingSource || '-', formatDate(item.dateAdded), item.description
                    ]);
                    break;
            }
            
            const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, type);
            XLSX.writeFile(wb, `Export_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportPDF(type) {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Header
            pdf.setFontSize(18);
            pdf.setFont('helvetica', 'bold');
            pdf.text(`LAPORAN ${type.toUpperCase()}`, 105, 20, { align: 'center' });
            
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'normal');
            pdf.text('SMK NEGERI 1 KEFAMENANU', 105, 30, { align: 'center' });
            pdf.text('NUSA TENGGARA TIMUR', 105, 40, { align: 'center' });
            
            // Date and info
            pdf.setFontSize(10);
            pdf.text(`Tanggal Cetak: ${formatDate(new Date().toISOString().split('T')[0])}`, 20, 55);
            pdf.text(`Dicetak oleh: ${currentUser.name} (${currentUser.role.toUpperCase()})`, 20, 60);
            
            // Line separator
            pdf.setLineWidth(0.5);
            pdf.line(20, 65, 190, 65);
            
            let yPos = 75;
            pdf.setFontSize(10);
            
            switch(type) {
                case 'inventaris':
                    // Table header
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Kode', 30, yPos);
                    pdf.text('Nama Peralatan', 50, yPos);
                    pdf.text('Kategori', 90, yPos);
                    pdf.text('Jurusan', 120, yPos);
                    pdf.text('Kelas', 140, yPos);
                    pdf.text('Kondisi', 165, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    equipment.forEach((item, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text(item.code, 30, yPos);
                        pdf.text(item.name.substring(0, 15), 50, yPos);
                        pdf.text(item.category.substring(0, 12), 90, yPos);
                        pdf.text(item.major || '-', 120, yPos);
                        pdf.text((item.class || '-').substring(0, 8), 140, yPos);
                        pdf.text(item.condition, 165, yPos);
                        yPos += 8;
                    });
                    
                    // Summary
                    yPos += 10;
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('RINGKASAN:', 20, yPos);
                    yPos += 8;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(`Total Peralatan: ${equipment.length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Kondisi Baik: ${equipment.filter(e => e.condition === 'Baik').length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Perlu Perbaikan: ${equipment.filter(e => e.condition === 'Perlu Perbaikan').length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Rusak: ${equipment.filter(e => e.condition === 'Rusak').length}`, 20, yPos);
                    break;
                    
                case 'jadwal':
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Peralatan', 35, yPos);
                    pdf.text('Kelas', 90, yPos);
                    pdf.text('Mata Pelajaran', 115, yPos);
                    pdf.text('Guru', 150, yPos);
                    pdf.text('Tanggal', 175, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    schedules.forEach((schedule, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        const equipmentItem = equipment.find(e => e.id === schedule.equipmentId);
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text((equipmentItem ? equipmentItem.name : 'Unknown').substring(0, 20), 35, yPos);
                        pdf.text(schedule.class, 90, yPos);
                        pdf.text(schedule.subject.substring(0, 15), 115, yPos);
                        pdf.text(schedule.teacher.substring(0, 12), 150, yPos);
                        pdf.text(formatDate(schedule.date), 175, yPos);
                        yPos += 8;
                    });
                    break;
                    
                case 'praktik':
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Nama Siswa', 35, yPos);
                    pdf.text('Kelas', 80, yPos);
                    pdf.text('Judul Praktik', 105, yPos);
                    pdf.text('Status', 150, yPos);
                    pdf.text('Nilai', 175, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    practiceReports.forEach((report, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text(report.student.substring(0, 18), 35, yPos);
                        pdf.text(report.class, 80, yPos);
                        pdf.text(report.title.substring(0, 18), 105, yPos);
                        pdf.text(report.status, 150, yPos);
                        pdf.text(report.score.toString(), 175, yPos);
                        yPos += 8;
                    });
                    
                    // Summary
                    yPos += 10;
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('RINGKASAN:', 20, yPos);
                    yPos += 8;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(`Total Laporan: ${practiceReports.length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Selesai: ${practiceReports.filter(r => r.status === 'Selesai').length}`, 20, yPos);
                    yPos += 5;
                    const avgScore = practiceReports.length > 0 ? (practiceReports.reduce((sum, r) => sum + r.score, 0) / practiceReports.length).toFixed(1) : 0;
                    pdf.text(`Rata-rata Nilai: ${avgScore}`, 20, yPos);
                    break;
                    
                case 'pemeliharaan':
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Peralatan', 35, yPos);
                    pdf.text('Jenis', 80, yPos);
                    pdf.text('Status', 115, yPos);
                    pdf.text('Teknisi', 140, yPos);
                    pdf.text('Biaya', 170, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    maintenanceRecords.forEach((record, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        const equipmentItem = equipment.find(e => e.id === record.equipmentId);
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text((equipmentItem ? equipmentItem.name : 'Unknown').substring(0, 18), 35, yPos);
                        pdf.text(record.type.substring(0, 12), 80, yPos);
                        pdf.text(record.status, 115, yPos);
                        pdf.text(record.technician.substring(0, 10), 140, yPos);
                        pdf.text(`${(record.cost / 1000).toFixed(0)}K`, 170, yPos);
                        yPos += 8;
                    });
                    
                    // Summary
                    yPos += 10;
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('RINGKASAN:', 20, yPos);
                    yPos += 8;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(`Total Pemeliharaan: ${maintenanceRecords.length}`, 20, yPos);
                    yPos += 5;
                    const totalCost = maintenanceRecords.reduce((sum, r) => sum + r.cost, 0);
                    pdf.text(`Total Biaya: ${formatCurrency(totalCost)}`, 20, yPos);
                    break;
                    
                case 'ukk':
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Nama Siswa', 35, yPos);
                    pdf.text('Jurusan', 80, yPos);
                    pdf.text('Kompetensi', 105, yPos);
                    pdf.text('Status', 150, yPos);
                    pdf.text('Nilai', 175, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    competencyDocuments.forEach((doc, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text(doc.student.substring(0, 18), 35, yPos);
                        pdf.text(doc.major, 80, yPos);
                        pdf.text(doc.competency.substring(0, 18), 105, yPos);
                        pdf.text(doc.status, 150, yPos);
                        pdf.text(doc.score.toString(), 175, yPos);
                        yPos += 8;
                    });
                    
                    // Summary
                    yPos += 10;
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('RINGKASAN:', 20, yPos);
                    yPos += 8;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(`Total Peserta UKK: ${competencyDocuments.length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Lulus: ${competencyDocuments.filter(d => d.status === 'Lulus').length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Tidak Lulus: ${competencyDocuments.filter(d => d.status === 'Tidak Lulus').length}`, 20, yPos);
                    yPos += 5;
                    const avgUkkScore = competencyDocuments.length > 0 ? (competencyDocuments.reduce((sum, d) => sum + d.score, 0) / competencyDocuments.length).toFixed(1) : 0;
                    pdf.text(`Rata-rata Nilai: ${avgUkkScore}`, 20, yPos);
                    break;
                    
                case 'sarpras':
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('No', 20, yPos);
                    pdf.text('Kode', 30, yPos);
                    pdf.text('Nama Sarana/Prasarana', 50, yPos);
                    pdf.text('Kategori', 100, yPos);
                    pdf.text('Kondisi', 130, yPos);
                    pdf.text('Sumber Dana', 155, yPos);
                    pdf.text('Luas', 180, yPos);
                    yPos += 5;
                    pdf.line(20, yPos, 190, yPos);
                    yPos += 5;
                    
                    pdf.setFont('helvetica', 'normal');
                    sarprasData.forEach((item, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.text(`${index + 1}`, 20, yPos);
                        pdf.text(item.code, 30, yPos);
                        pdf.text(item.name.substring(0, 20), 50, yPos);
                        pdf.text(item.category.substring(0, 10), 100, yPos);
                        pdf.text(item.condition.substring(0, 8), 130, yPos);
                        pdf.text((item.fundingSource || '-').substring(0, 8), 155, yPos);
                        pdf.text(`${item.area}m¬≤`, 180, yPos);
                        yPos += 8;
                    });
                    
                    // Summary
                    yPos += 10;
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('RINGKASAN:', 20, yPos);
                    yPos += 8;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(`Total Sarana Prasarana: ${sarprasData.length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Kondisi Baik: ${sarprasData.filter(s => s.condition === 'Baik').length}`, 20, yPos);
                    yPos += 5;
                    pdf.text(`Perlu Perbaikan: ${sarprasData.filter(s => s.condition === 'Perlu Perbaikan').length}`, 20, yPos);
                    yPos += 5;
                    const totalArea = sarprasData.reduce((sum, s) => sum + s.area, 0);
                    pdf.text(`Total Luas Area: ${totalArea} m¬≤`, 20, yPos);
                    break;
            }
            
            // Footer
            pdf.setFontSize(8);
            pdf.text(`Halaman 1 - Dicetak pada ${new Date().toLocaleString('id-ID')}`, 105, 285, { align: 'center' });
            
            pdf.save(`Laporan_${type}_${new Date().toISOString().split('T')[0]}.pdf`);
            addRecentActivity(`Laporan ${type} berhasil diekspor ke PDF`);
        }

        // Delete functions
        function deleteEquipment(id) {
            if (confirm('Apakah Anda yakin ingin menghapus peralatan ini?')) {
                equipment = equipment.filter(e => e.id !== id);
                renderEquipmentTable();
                updateDashboard();
                populateEquipmentSelects();
                addRecentActivity('Peralatan dihapus dari inventaris');
            }
        }

        function deleteSchedule(id) {
            if (confirm('Apakah Anda yakin ingin menghapus jadwal ini?')) {
                schedules = schedules.filter(s => s.id !== id);
                renderScheduleTable();
                addRecentActivity('Jadwal dihapus');
            }
        }

        function deleteReport(id) {
            if (confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                practiceReports = practiceReports.filter(r => r.id !== id);
                renderPracticeReports();
                updateDashboard();
                addRecentActivity('Laporan praktik dihapus');
            }
        }

        function deleteMaintenance(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data pemeliharaan ini?')) {
                maintenanceRecords = maintenanceRecords.filter(m => m.id !== id);
                renderMaintenanceList();
                updateDashboard();
                addRecentActivity('Data pemeliharaan dihapus');
            }
        }

        // Add recent activity
        function addRecentActivity(message) {
            const activitiesContainer = document.getElementById('recentActivities');
            if (!activitiesContainer) return;
            
            const activityElement = document.createElement('div');
            activityElement.className = 'flex items-center space-x-4 p-3 bg-gray-50 rounded-lg fade-in';
            activityElement.innerHTML = `
                <div class="bg-blue-100 p-2 rounded-full">
                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900">${message}</p>
                    <p class="text-xs text-gray-500">${new Date().toLocaleString('id-ID')}</p>
                </div>
            `;
            
            // Insert at the beginning
            activitiesContainer.insertBefore(activityElement, activitiesContainer.firstChild);
            
            // Keep only last 5 activities
            while (activitiesContainer.children.length > 5) {
                activitiesContainer.removeChild(activitiesContainer.lastChild);
            }
        }

        function deleteCompetency(id) {
            if (confirm('Apakah Anda yakin ingin menghapus dokumen kompetensi ini?')) {
                competencyDocuments = competencyDocuments.filter(c => c.id !== id);
                renderCompetencyDocuments();
                updateDashboard();
                addRecentActivity('Dokumen kompetensi dihapus');
            }
        }

        function deleteCategory(index) {
            if (confirm('Apakah Anda yakin ingin menghapus kategori ini?')) {
                categories.splice(index, 1);
                renderMasterData();
                populateCategories();
                addRecentActivity('Kategori dihapus');
            }
        }

        function deleteMajor(index) {
            if (confirm('Apakah Anda yakin ingin menghapus jurusan ini?')) {
                majors.splice(index, 1);
                renderMasterData();
                populateMajors();
                addRecentActivity('Jurusan dihapus');
            }
        }

        function deleteSubject(index) {
            if (confirm('Apakah Anda yakin ingin menghapus mata pelajaran ini?')) {
                subjects.splice(index, 1);
                renderMasterData();
                populateSubjects();
                addRecentActivity('Mata pelajaran dihapus');
            }
        }

        function deleteClass(index) {
            if (confirm('Apakah Anda yakin ingin menghapus kelas ini?')) {
                classes.splice(index, 1);
                renderMasterData();
                populateClasses();
                addRecentActivity('Kelas dihapus');
            }
        }

        function deleteSarpras(id) {
            if (confirm('Apakah Anda yakin ingin menghapus sarana prasarana ini?')) {
                sarprasData = sarprasData.filter(s => s.id !== id);
                renderSarprasTable();
                updateDashboard();
                addRecentActivity('Sarana prasarana dihapus');
            }
        }

        // Kelas (Class Reports) Functions
        function filterKelasReports() {
            const classFilter = document.getElementById('filterKelasClass').value;
            const subjectFilter = document.getElementById('filterKelasSubject').value;
            const monthFilter = document.getElementById('filterKelasMonth').value;
            const yearFilter = document.getElementById('filterKelasYear').value;
            
            renderKelasReports(classFilter, subjectFilter, monthFilter, yearFilter);
        }

        function renderKelasReports(classFilter = '', subjectFilter = '', monthFilter = '', yearFilter = '') {
            // Filter practice reports based on user role and filters
            let filteredReports = filterDataByMajor(practiceReports, 'class');
            
            if (classFilter) {
                filteredReports = filteredReports.filter(report => report.class === classFilter);
            }
            
            if (subjectFilter) {
                filteredReports = filteredReports.filter(report => report.subject === subjectFilter);
            }
            
            if (monthFilter) {
                filteredReports = filteredReports.filter(report => {
                    const reportMonth = new Date(report.date).getMonth() + 1;
                    return reportMonth.toString().padStart(2, '0') === monthFilter;
                });
            }
            
            if (yearFilter) {
                filteredReports = filteredReports.filter(report => {
                    const reportYear = new Date(report.date).getFullYear();
                    return reportYear.toString() === yearFilter;
                });
            }
            
            // Group reports by class and subject
            const groupedReports = {};
            filteredReports.forEach(report => {
                const key = `${report.class}_${report.subject}`;
                if (!groupedReports[key]) {
                    groupedReports[key] = {
                        class: report.class,
                        subject: report.subject,
                        reports: [],
                        totalStudents: 0,
                        averageScore: 0,
                        completedReports: 0
                    };
                }
                groupedReports[key].reports.push(report);
            });
            
            // Calculate statistics for each group
            Object.keys(groupedReports).forEach(key => {
                const group = groupedReports[key];
                group.totalStudents = group.reports.length;
                group.completedReports = group.reports.filter(r => r.status === 'Selesai').length;
                group.averageScore = group.totalStudents > 0 ? 
                    (group.reports.reduce((sum, r) => sum + r.score, 0) / group.totalStudents).toFixed(1) : 0;
            });
            
            // Render summary cards
            renderKelasSummaryCards(filteredReports, groupedReports);
            
            // Render class reports
            const container = document.getElementById('kelasReports');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (Object.keys(groupedReports).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-gray-400 text-6xl mb-4">üéì</div>
                        <p class="text-gray-500">Tidak ada laporan kelas yang ditemukan</p>
                    </div>
                `;
                return;
            }
            
            Object.values(groupedReports).forEach(group => {
                const reportElement = document.createElement('div');
                reportElement.className = 'bg-white border border-gray-200 rounded-lg p-6 shadow-sm';
                
                // Calculate grade distribution
                const gradeDistribution = {
                    A: group.reports.filter(r => r.score >= 85).length,
                    B: group.reports.filter(r => r.score >= 75 && r.score < 85).length,
                    C: group.reports.filter(r => r.score >= 65 && r.score < 75).length,
                    D: group.reports.filter(r => r.score < 65).length
                };
                
                reportElement.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-900 mb-1">${group.class}</h4>
                            <p class="text-sm text-gray-600">Mata Pelajaran: ${group.subject}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-blue-600">${group.averageScore}</p>
                            <p class="text-xs text-gray-500">Rata-rata Nilai</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <p class="text-2xl font-bold text-blue-600">${group.totalStudents}</p>
                            <p class="text-xs text-blue-700">Total Siswa</p>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <p class="text-2xl font-bold text-green-600">${group.completedReports}</p>
                            <p class="text-xs text-green-700">Selesai</p>
                        </div>
                        <div class="text-center p-3 bg-yellow-50 rounded-lg">
                            <p class="text-2xl font-bold text-yellow-600">${group.totalStudents - group.completedReports}</p>
                            <p class="text-xs text-yellow-700">Belum Selesai</p>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <p class="text-2xl font-bold text-purple-600">${Math.round((group.completedReports / group.totalStudents) * 100)}%</p>
                            <p class="text-xs text-purple-700">Progress</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="font-medium text-gray-900 mb-2">Distribusi Nilai</h5>
                        <div class="grid grid-cols-4 gap-2">
                            <div class="text-center p-2 bg-green-100 rounded">
                                <p class="font-bold text-green-800">${gradeDistribution.A}</p>
                                <p class="text-xs text-green-600">A (85-100)</p>
                            </div>
                            <div class="text-center p-2 bg-blue-100 rounded">
                                <p class="font-bold text-blue-800">${gradeDistribution.B}</p>
                                <p class="text-xs text-blue-600">B (75-84)</p>
                            </div>
                            <div class="text-center p-2 bg-yellow-100 rounded">
                                <p class="font-bold text-yellow-800">${gradeDistribution.C}</p>
                                <p class="text-xs text-yellow-600">C (65-74)</p>
                            </div>
                            <div class="text-center p-2 bg-red-100 rounded">
                                <p class="font-bold text-red-800">${gradeDistribution.D}</p>
                                <p class="text-xs text-red-600">D (<65)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center">
                            <button onclick="viewKelasDetail('${group.class}', '${group.subject}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                üìä Lihat Detail Siswa
                            </button>
                            <div class="space-x-2">
                                <button onclick="exportKelasDetailPDF('${group.class}', '${group.subject}')" class="text-green-600 hover:text-green-800 text-sm">
                                    üìÑ Export PDF
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(reportElement);
            });
        }

        function renderKelasSummaryCards(filteredReports, groupedReports) {
            const container = document.getElementById('kelasSummaryCards');
            if (!container) return;
            
            const totalClasses = Object.keys(groupedReports).length;
            const totalStudents = filteredReports.length;
            const completedReports = filteredReports.filter(r => r.status === 'Selesai').length;
            const averageScore = totalStudents > 0 ? 
                (filteredReports.reduce((sum, r) => sum + r.score, 0) / totalStudents).toFixed(1) : 0;
            
            container.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-blue-600">${totalClasses}</p>
                    <p class="text-sm text-blue-700">Total Kelas</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-green-600">${totalStudents}</p>
                    <p class="text-sm text-green-700">Total Siswa</p>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-yellow-600">${completedReports}</p>
                    <p class="text-sm text-yellow-700">Laporan Selesai</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-purple-600">${averageScore}</p>
                    <p class="text-sm text-purple-700">Rata-rata Nilai</p>
                </div>
            `;
        }

        function populateKelasFilters() {
            // Populate class filter
            const classFilter = document.getElementById('filterKelasClass');
            if (classFilter) {
                const userFilteredReports = filterDataByMajor(practiceReports, 'class');
                const uniqueClasses = [...new Set(userFilteredReports.map(r => r.class))];
                classFilter.innerHTML = '<option value="">Semua Kelas</option>';
                uniqueClasses.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    classFilter.appendChild(option);
                });
            }
            
            // Populate subject filter
            const subjectFilter = document.getElementById('filterKelasSubject');
            if (subjectFilter) {
                const userFilteredReports = filterDataByMajor(practiceReports, 'class');
                const uniqueSubjects = [...new Set(userFilteredReports.map(r => r.subject))];
                subjectFilter.innerHTML = '<option value="">Semua Mata Pelajaran</option>';
                uniqueSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectFilter.appendChild(option);
                });
            }
            
            // Populate year filter
            const yearFilter = document.getElementById('filterKelasYear');
            if (yearFilter) {
                const userFilteredReports = filterDataByMajor(practiceReports, 'class');
                const uniqueYears = [...new Set(userFilteredReports.map(r => new Date(r.date).getFullYear()))];
                yearFilter.innerHTML = '<option value="">Semua Tahun</option>';
                uniqueYears.sort((a, b) => b - a).forEach(year => {
                    const option = document.createElement('option');
                    option.value = year.toString();
                    option.textContent = year.toString();
                    yearFilter.appendChild(option);
                });
            }
        }

        function viewKelasDetail(className, subject) {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('detailContent');
            
            // Filter reports for this class and subject
            const classReports = filterDataByMajor(practiceReports, 'class')
                .filter(r => r.class === className && r.subject === subject);
            
            if (classReports.length === 0) {
                alert('Tidak ada laporan untuk kelas dan mata pelajaran ini!');
                return;
            }
            
            // Calculate statistics
            const totalStudents = classReports.length;
            const completedReports = classReports.filter(r => r.status === 'Selesai').length;
            const averageScore = (classReports.reduce((sum, r) => sum + r.score, 0) / totalStudents).toFixed(1);
            
            let html = `
                <div class="space-y-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-lg mb-3 text-gray-900">Detail Kelas ${className}</h4>
                        <p class="text-gray-600 mb-4">Mata Pelajaran: ${subject}</p>
                        
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="text-center p-3 bg-blue-50 rounded">
                                <p class="text-xl font-bold text-blue-600">${totalStudents}</p>
                                <p class="text-sm text-blue-700">Total Siswa</p>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded">
                                <p class="text-xl font-bold text-green-600">${completedReports}</p>
                                <p class="text-sm text-green-700">Selesai</p>
                            </div>
                            <div class="text-center p-3 bg-purple-50 rounded">
                                <p class="text-xl font-bold text-purple-600">${averageScore}</p>
                                <p class="text-sm text-purple-700">Rata-rata</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white border rounded-lg">
                        <div class="px-4 py-3 border-b bg-gray-50">
                            <h5 class="font-medium text-gray-900">Daftar Siswa</h5>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Siswa</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">NIS</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Judul Praktik</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tanggal</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nilai</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            classReports.forEach((report, index) => {
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 text-sm text-gray-900">${index + 1}</td>
                        <td class="px-4 py-2 text-sm font-medium text-gray-900">${report.student}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${report.nis || '-'}</td>
                        <td class="px-4 py-2 text-sm text-gray-900">${report.title}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${formatDate(report.date)}</td>
                        <td class="px-4 py-2">
                            <span class="px-2 py-1 ${getStatusColor(report.status)} text-xs rounded-full font-medium">${report.status}</span>
                        </td>
                        <td class="px-4 py-2 text-sm font-bold ${report.score >= 75 ? 'text-green-600' : report.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">${report.score}</td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="flex justify-center space-x-4 pt-4">
                        <button onclick="exportKelasDetailPDF('${className}', '${subject}')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                            üìÑ Export PDF
                        </button>
                        <button onclick="hideDetailModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function exportKelasExcel() {
            const classFilter = document.getElementById('filterKelasClass').value;
            const subjectFilter = document.getElementById('filterKelasSubject').value;
            const monthFilter = document.getElementById('filterKelasMonth').value;
            const yearFilter = document.getElementById('filterKelasYear').value;
            
            // Filter reports
            let filteredReports = filterDataByMajor(practiceReports, 'class');
            
            if (classFilter) filteredReports = filteredReports.filter(r => r.class === classFilter);
            if (subjectFilter) filteredReports = filteredReports.filter(r => r.subject === subjectFilter);
            if (monthFilter) {
                filteredReports = filteredReports.filter(r => {
                    const reportMonth = new Date(r.date).getMonth() + 1;
                    return reportMonth.toString().padStart(2, '0') === monthFilter;
                });
            }
            if (yearFilter) {
                filteredReports = filteredReports.filter(r => {
                    const reportYear = new Date(r.date).getFullYear();
                    return reportYear.toString() === yearFilter;
                });
            }
            
            const headers = ['No', 'Nama Siswa', 'NIS', 'Kelas', 'Mata Pelajaran', 'Judul Praktik', 'Tanggal', 'Status', 'Nilai', 'Grade'];
            const data = filteredReports.map((report, index) => [
                index + 1,
                report.student,
                report.nis || '-',
                report.class,
                report.subject,
                report.title,
                formatDate(report.date),
                report.status,
                report.score,
                report.grade || '-'
            ]);
            
            const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Kelas');
            XLSX.writeFile(wb, `Laporan_Kelas_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportKelasPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Header
            pdf.setFontSize(18);
            pdf.setFont('helvetica', 'bold');
            pdf.text('LAPORAN KELAS PER MATA PELAJARAN', 105, 20, { align: 'center' });
            
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'normal');
            pdf.text('SMK NEGERI 1 KEFAMENANU', 105, 30, { align: 'center' });
            
            // Filter info
            const classFilter = document.getElementById('filterKelasClass').value;
            const subjectFilter = document.getElementById('filterKelasSubject').value;
            const monthFilter = document.getElementById('filterKelasMonth').value;
            const yearFilter = document.getElementById('filterKelasYear').value;
            
            let yPos = 50;
            pdf.setFontSize(10);
            pdf.text(`Tanggal Cetak: ${formatDate(new Date().toISOString().split('T')[0])}`, 20, yPos);
            yPos += 5;
            pdf.text(`Dicetak oleh: ${currentUser.name} (${currentUser.role.toUpperCase()})`, 20, yPos);
            yPos += 5;
            
            if (classFilter || subjectFilter || monthFilter || yearFilter) {
                pdf.text('Filter:', 20, yPos);
                yPos += 5;
                if (classFilter) { pdf.text(`- Kelas: ${classFilter}`, 25, yPos); yPos += 5; }
                if (subjectFilter) { pdf.text(`- Mata Pelajaran: ${subjectFilter}`, 25, yPos); yPos += 5; }
                if (monthFilter) { pdf.text(`- Bulan: ${monthFilter}`, 25, yPos); yPos += 5; }
                if (yearFilter) { pdf.text(`- Tahun: ${yearFilter}`, 25, yPos); yPos += 5; }
            }
            
            yPos += 10;
            pdf.setLineWidth(0.5);
            pdf.line(20, yPos, 190, yPos);
            yPos += 10;
            
            // Get filtered data
            let filteredReports = filterDataByMajor(practiceReports, 'class');
            if (classFilter) filteredReports = filteredReports.filter(r => r.class === classFilter);
            if (subjectFilter) filteredReports = filteredReports.filter(r => r.subject === subjectFilter);
            if (monthFilter) {
                filteredReports = filteredReports.filter(r => {
                    const reportMonth = new Date(r.date).getMonth() + 1;
                    return reportMonth.toString().padStart(2, '0') === monthFilter;
                });
            }
            if (yearFilter) {
                filteredReports = filteredReports.filter(r => {
                    const reportYear = new Date(r.date).getFullYear();
                    return reportYear.toString() === yearFilter;
                });
            }
            
            // Group by class and subject
            const groupedReports = {};
            filteredReports.forEach(report => {
                const key = `${report.class}_${report.subject}`;
                if (!groupedReports[key]) {
                    groupedReports[key] = {
                        class: report.class,
                        subject: report.subject,
                        reports: []
                    };
                }
                groupedReports[key].reports.push(report);
            });
            
            // Render each group
            Object.values(groupedReports).forEach(group => {
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text(`${group.class} - ${group.subject}`, 20, yPos);
                yPos += 10;
                
                const totalStudents = group.reports.length;
                const completedReports = group.reports.filter(r => r.status === 'Selesai').length;
                const averageScore = (group.reports.reduce((sum, r) => sum + r.score, 0) / totalStudents).toFixed(1);
                
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(10);
                pdf.text(`Total Siswa: ${totalStudents} | Selesai: ${completedReports} | Rata-rata: ${averageScore}`, 20, yPos);
                yPos += 10;
                
                // Table header
                pdf.setFont('helvetica', 'bold');
                pdf.text('No', 20, yPos);
                pdf.text('Nama Siswa', 30, yPos);
                pdf.text('Judul Praktik', 80, yPos);
                pdf.text('Tanggal', 130, yPos);
                pdf.text('Status', 155, yPos);
                pdf.text('Nilai', 175, yPos);
                yPos += 5;
                pdf.line(20, yPos, 190, yPos);
                yPos += 5;
                
                // Table content
                pdf.setFont('helvetica', 'normal');
                group.reports.forEach((report, index) => {
                    if (yPos > 270) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    pdf.text(`${index + 1}`, 20, yPos);
                    pdf.text(report.student.substring(0, 20), 30, yPos);
                    pdf.text(report.title.substring(0, 20), 80, yPos);
                    pdf.text(formatDate(report.date), 130, yPos);
                    pdf.text(report.status, 155, yPos);
                    pdf.text(report.score.toString(), 175, yPos);
                    yPos += 7;
                });
                
                yPos += 10;
            });
            
            pdf.save(`Laporan_Kelas_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function exportKelasDetailPDF(className, subject) {
            const classReports = filterDataByMajor(practiceReports, 'class')
                .filter(r => r.class === className && r.subject === subject);
            
            if (classReports.length === 0) {
                alert('Tidak ada data untuk diekspor!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Header
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'bold');
            pdf.text(`LAPORAN DETAIL KELAS ${className}`, 105, 20, { align: 'center' });
            
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Mata Pelajaran: ${subject}`, 105, 30, { align: 'center' });
            pdf.text('SMK NEGERI 1 KEFAMENANU', 105, 40, { align: 'center' });
            
            // Statistics
            const totalStudents = classReports.length;
            const completedReports = classReports.filter(r => r.status === 'Selesai').length;
            const averageScore = (classReports.reduce((sum, r) => sum + r.score, 0) / totalStudents).toFixed(1);
            
            let yPos = 60;
            pdf.setFontSize(10);
            pdf.text(`Total Siswa: ${totalStudents}`, 20, yPos);
            pdf.text(`Laporan Selesai: ${completedReports}`, 80, yPos);
            pdf.text(`Rata-rata Nilai: ${averageScore}`, 140, yPos);
            yPos += 15;
            
            // Table
            pdf.setFont('helvetica', 'bold');
            pdf.text('No', 20, yPos);
            pdf.text('Nama Siswa', 30, yPos);
            pdf.text('NIS', 80, yPos);
            pdf.text('Judul Praktik', 100, yPos);
            pdf.text('Tanggal', 150, yPos);
            pdf.text('Nilai', 175, yPos);
            yPos += 5;
            pdf.line(20, yPos, 190, yPos);
            yPos += 5;
            
            pdf.setFont('helvetica', 'normal');
            classReports.forEach((report, index) => {
                if (yPos > 270) {
                    pdf.addPage();
                    yPos = 20;
                }
                pdf.text(`${index + 1}`, 20, yPos);
                pdf.text(report.student.substring(0, 18), 30, yPos);
                pdf.text(report.nis || '-', 80, yPos);
                pdf.text(report.title.substring(0, 18), 100, yPos);
                pdf.text(formatDate(report.date), 150, yPos);
                pdf.text(report.score.toString(), 175, yPos);
                yPos += 7;
            });
            
            pdf.save(`Detail_Kelas_${className.replace(/\s+/g, '_')}_${subject.replace(/\s+/g, '_')}.pdf`);
        }

        // Export individual report to PDF
        function exportReportPDF(reportId) {
            const report = practiceReports.find(r => r.id === reportId);
            if (!report) {
                alert('Laporan tidak ditemukan!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Header
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'bold');
            pdf.text('LAPORAN PRAKTIK PENGGUNAAN ALAT & BAHAN', 105, 20, { align: 'center' });
            
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'normal');
            pdf.text('SMK NEGERI 1 KEFAMENANU', 105, 30, { align: 'center' });
            
            // Student info
            let yPos = 50;
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('INFORMASI SISWA', 20, yPos);
            yPos += 10;
            
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Nama Siswa: ${report.student}`, 20, yPos);
            pdf.text(`NIS: ${report.nis || '-'}`, 120, yPos);
            yPos += 7;
            pdf.text(`Kelas: ${report.class}`, 20, yPos);
            pdf.text(`Tanggal: ${formatDate(report.date)}`, 120, yPos);
            yPos += 7;
            pdf.text(`Mata Pelajaran: ${report.subject}`, 20, yPos);
            yPos += 7;
            pdf.text(`Guru Pembimbing: ${report.teacher || '-'}`, 20, yPos);
            pdf.text(`Waktu: ${report.startTime || '-'} - ${report.endTime || '-'}`, 120, yPos);
            yPos += 7;
            pdf.text(`Durasi Praktik: ${report.duration || '-'}`, 20, yPos);
            yPos += 15;
            
            // Practice details
            pdf.setFont('helvetica', 'bold');
            pdf.text('DETAIL PRAKTIK', 20, yPos);
            yPos += 10;
            
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Judul Praktik: ${report.title}`, 20, yPos);
            yPos += 10;
            
            if (report.objective) {
                pdf.text('Tujuan Praktik:', 20, yPos);
                yPos += 7;
                const objectiveLines = pdf.splitTextToSize(report.objective, 170);
                pdf.text(objectiveLines, 20, yPos);
                yPos += objectiveLines.length * 5 + 5;
            }
            
            // Equipment used
            if (report.equipmentUsed && report.equipmentUsed.length > 0) {
                pdf.setFont('helvetica', 'bold');
                pdf.text('ALAT YANG DIGUNAKAN', 20, yPos);
                yPos += 7;
                
                pdf.setFont('helvetica', 'normal');
                report.equipmentUsed.forEach((eq, index) => {
                    const equipmentItem = equipment.find(e => e.id === eq.equipmentId);
                    const equipmentName = equipmentItem ? equipmentItem.name : 'Unknown';
                    pdf.text(`${index + 1}. ${equipmentName}`, 25, yPos);
                    pdf.text(`Kondisi Awal: ${eq.conditionBefore}`, 30, yPos + 5);
                    pdf.text(`Kondisi Akhir: ${eq.conditionAfter}`, 30, yPos + 10);
                    yPos += 20;
                });
                yPos += 5;
            }
            
            // Materials used
            if (report.materialsUsed && report.materialsUsed.length > 0) {
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.text('BAHAN YANG DIGUNAKAN', 20, yPos);
                yPos += 7;
                
                pdf.setFont('helvetica', 'normal');
                report.materialsUsed.forEach((mat, index) => {
                    pdf.text(`${index + 1}. ${mat.name}: ${mat.quantity} ${mat.unit}`, 25, yPos);
                    yPos += 7;
                });
                yPos += 10;
            }
            
            // Results and conclusion
            if (report.result) {
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.text('HASIL PRAKTIK', 20, yPos);
                yPos += 7;
                
                pdf.setFont('helvetica', 'normal');
                const resultLines = pdf.splitTextToSize(report.result, 170);
                pdf.text(resultLines, 20, yPos);
                yPos += resultLines.length * 5 + 10;
            }
            
            if (report.conclusion) {
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.text('KESIMPULAN', 20, yPos);
                yPos += 7;
                
                pdf.setFont('helvetica', 'normal');
                const conclusionLines = pdf.splitTextToSize(report.conclusion, 170);
                pdf.text(conclusionLines, 20, yPos);
                yPos += conclusionLines.length * 5 + 15;
            }
            
            // Assessment
            if (yPos > 250) {
                pdf.addPage();
                yPos = 20;
            }
            
            pdf.setFont('helvetica', 'bold');
            pdf.text('PENILAIAN', 20, yPos);
            yPos += 10;
            
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Nilai: ${report.score}`, 20, yPos);
            pdf.text(`Grade: ${report.grade || '-'}`, 80, yPos);
            pdf.text(`Status: ${report.status}`, 140, yPos);
            yPos += 10;
            
            if (report.notes) {
                pdf.text('Catatan Guru:', 20, yPos);
                yPos += 7;
                const notesLines = pdf.splitTextToSize(report.notes, 170);
                pdf.text(notesLines, 20, yPos);
                yPos += notesLines.length * 5 + 15;
            }
            
            // Signature area
            yPos += 20;
            pdf.text('Mengetahui,', 20, yPos);
            pdf.text('Siswa,', 140, yPos);
            yPos += 20;
            pdf.text('Guru Pembimbing', 20, yPos);
            pdf.text(report.student, 140, yPos);
            yPos += 15;
            pdf.text('_________________', 20, yPos);
            pdf.text('_________________', 140, yPos);
            
            // Save PDF
            pdf.save(`Laporan_Praktik_${report.student.replace(/\s+/g, '_')}_${report.date}.pdf`);
            addRecentActivity(`Laporan praktik ${report.student} berhasil diekspor ke PDF`);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9767d8e974093da1',t:'MTc1NjQyNjQ1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
<!-- filepath: c:\Users\new-user\Downloads\Sistem Arsip Bengkel SMK\index.html -->
<!-- ...existing code... -->
<div id="pengaturan" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Pengaturan Sistem</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Backup & Restore -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="font-medium text-gray-900 mb-3">Backup & Restore Data</h4>
                <button onclick="backupData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium mb-2">üîÑ Backup Data</button>
                <input type="file" id="restoreInput" accept=".json" class="hidden" onchange="restoreData(event)">
                <button onclick="document.getElementById('restoreInput').click()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">‚ôªÔ∏è Restore Data</button>
            </div>
            <!-- Pengaturan Role Login -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="font-medium text-gray-900 mb-3">Pengaturan Role Login</h4>
                <form id="addRoleForm">
                    <div class="space-y-2">
                        <input type="text" id="newRoleUsername" placeholder="Username" class="w-full border rounded px-3 py-2" required>
                        <input type="password" id="newRolePassword" placeholder="Password" class="w-full border rounded px-3 py-2" required>
                        <select id="newRoleType" class="w-full border rounded px-3 py-2" required>
                            <option value="">Pilih Role</option>
                            <option value="admin">Admin</option>
                            <option value="kekom">Kepala Kompetensi Keahlian</option>
                            <option value="kabeng">Kepala Bengkel</option>
                            <option value="waka_sarpras">Wakil Kepala Sarpras</option>
                        </select>
                        <input type="text" id="newRoleName" placeholder="Nama Lengkap" class="w-full border rounded px-3 py-2" required>
                        <input type="text" id="newRoleMajor" placeholder="Kode Jurusan (opsional)" class="w-full border rounded px-3 py-2">
                    </div>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium mt-3">+ Tambah Role</button>
                </form>
                <div id="roleList" class="mt-4 space-y-2"></div>
            </div>
        </div>
    </div>
</div>
<!-- ...existing code... -->